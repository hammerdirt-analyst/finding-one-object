
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The chance of finding an object &#8212; Chance of an encounter</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="References" href="references.html" />
    <link rel="prev" title="The probability of trash" href="titlepage.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Chance of an encounter</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="titlepage.html">
   The probability of trash
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The probality of FHP
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   The chance of finding an object
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="references.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/chance_of_an_encounter.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/hammerdirt-analyst/finding-one-object"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/hammerdirt-analyst/finding-one-object/issues/new?title=Issue%20on%20page%20%2Fchance_of_an_encounter.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hammerdirt-analyst/finding-one-object/main?urlpath=tree/docs/chance_of_an_encounter.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contents">
   Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   INTRODUCTION
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-and-methods">
   DATA AND METHODS
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#study-sites">
     Study sites
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#map-one-survey-locations-in-the-petite-and-grand-lac-november-2015-novemeber-2021">
       <strong>
        Map one: survey locations in the Petite and Grand lac, November 2015 - Novemeber 2021
       </strong>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data">
     Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#statistical-methods">
   Statistical methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results-and-discussion">
   Results and discussion
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selecting-a-survey-strategy-for-end-period-plastics">
     Selecting a survey strategy for End Period Plastics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#environmental-policy-implications">
   ENVIRONMENTAL POLICY IMPLICATIONS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#supporting-figures-and-calculations">
   Supporting figures and calculations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#s1-survey-locations-number-of-samples-and-the-number-of-times-an-fhp-was-identified">
     S1: Survey locations, number of samples and the number of times an FHP was identified
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#s2-expected-values-holding-the-data-constant-and-changing-theta">
     S2: Expected values holding the data constant and changing
     <span class="math notranslate nohighlight">
      \(\theta\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#s3-scaling-the-prior-minimizing-alpha-beta">
     S3: Scaling the prior, minimizing
     <span class="math notranslate nohighlight">
      \(\alpha\)
     </span>
     ,
     <span class="math notranslate nohighlight">
      \(\beta\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#s4-computing-the-integrals-for-marginal-probabiltity">
     S4: Computing the integrals for marginal probabiltity
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#s5-drawing-samples-from-the-posterior-distribution-of-each-location">
     S5: Drawing samples from the posterior distribution of each location
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>The chance of finding an object</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contents">
   Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   INTRODUCTION
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-and-methods">
   DATA AND METHODS
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#study-sites">
     Study sites
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#map-one-survey-locations-in-the-petite-and-grand-lac-november-2015-novemeber-2021">
       <strong>
        Map one: survey locations in the Petite and Grand lac, November 2015 - Novemeber 2021
       </strong>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data">
     Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#statistical-methods">
   Statistical methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results-and-discussion">
   Results and discussion
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selecting-a-survey-strategy-for-end-period-plastics">
     Selecting a survey strategy for End Period Plastics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#environmental-policy-implications">
   ENVIRONMENTAL POLICY IMPLICATIONS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#supporting-figures-and-calculations">
   Supporting figures and calculations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#s1-survey-locations-number-of-samples-and-the-number-of-times-an-fhp-was-identified">
     S1: Survey locations, number of samples and the number of times an FHP was identified
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#s2-expected-values-holding-the-data-constant-and-changing-theta">
     S2: Expected values holding the data constant and changing
     <span class="math notranslate nohighlight">
      \(\theta\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#s3-scaling-the-prior-minimizing-alpha-beta">
     S3: Scaling the prior, minimizing
     <span class="math notranslate nohighlight">
      \(\alpha\)
     </span>
     ,
     <span class="math notranslate nohighlight">
      \(\beta\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#s4-computing-the-integrals-for-marginal-probabiltity">
     S4: Computing the integrals for marginal probabiltity
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#s5-drawing-samples-from-the-posterior-distribution-of-each-location">
     S5: Drawing samples from the posterior distribution of each location
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sys, file and nav packages:</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># math packages:</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">poisson</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">binom</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">beta</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">nbinom</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">import</span> <span class="n">GridSpec</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>

<span class="c1"># images and display</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">PILImage</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span> <span class="k">as</span> <span class="n">md</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Image</span>

<span class="c1"># set some parameters:</span>
<span class="c1"># today = dt.datetime.now().date().strftime(&quot;%Y-%m-%d&quot;)</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;2015-11-01&#39;</span>
<span class="n">end_date</span> <span class="o">=</span><span class="s1">&#39;2021-11-01&#39;</span>

<span class="n">dfBeaches</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/beaches_with_land_use_rates.csv&quot;</span><span class="p">)</span>
<span class="c1"># dfDims = pd.read_csv(&quot;resources/corrected_dims.csv&quot;)</span>

<span class="c1"># set the index of the beach data to location slug</span>
<span class="n">dfBeaches</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;slug&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># all data since 2015</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/checked_before_agg_sdata_eos_2020_21.csv&quot;</span><span class="p">)</span>

<span class="n">ldb</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">water_name_slug</span> <span class="o">==</span> <span class="s2">&quot;lac-leman&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># assign loc_date</span>
<span class="n">ldb</span><span class="p">[</span><span class="s1">&#39;loc_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ldb</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">ldb</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]))</span>

<span class="c1"># date to datetime</span>
<span class="n">ldb</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ldb</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ldb</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ldb</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

<span class="c1"># agg codes and groups</span>
<span class="n">code</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;G144&#39;</span><span class="p">,</span> <span class="s1">&#39;G96&#39;</span><span class="p">]</span>
<span class="n">fhg</span> <span class="o">=</span> <span class="n">ldb</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input tag_remove-input docutils container">
</div>
<div class="cell tag_hide-input tag_remove-input docutils container">
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="the-chance-of-finding-an-object">
<h1>The chance of finding an object<a class="headerlink" href="#the-chance-of-finding-an-object" title="Permalink to this headline">¶</a></h1>
<p><em>Roger Erismann, Romain Tramoy, Bhavish Patel, Montserrat Filella</em></p>
<p><strong>Affiliations</strong></p>
<p><strong>Roger Erismann</strong> - Hammerdirt, Brugstrasse 39, CH-2503 Biel, Switzerland</p>
<p><strong>Romain Tramoy</strong> - Laboratoire Eau Environment et Systèmes Urbains (LEESU), 61 Av. du Général de Gaulle, F-94000 Créteil, France</p>
<p><strong>Bhavish Patel</strong> - Paul Scherer Institute (PSI), Forschungsstrasse 111, CH-5232 Villigen PSI, Switzerland</p>
<p><strong>Montserrat Filella</strong> - Department F.-A. Forel, University of Geneva, Boulevard Carl-Vogt 66, CH-1205 Geneva, Switzerland</p>
<p><strong>Contact:</strong> <a class="reference external" href="mailto:roger&#37;&#52;&#48;hammerdirt&#46;ch">roger<span>&#64;</span>hammerdirt<span>&#46;</span>ch</a></p>
<p>Abstract</p>
<p>[to be completed]</p>
<p>Keywords: Switzerland, Lake Geneva, Bayes theorem, feminine hygiene products, marine-litter, riverine-input, LCA, marine litter indicator</p>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Data and Methods</p>
<ol class="simple">
<li><p>Description of the survey area</p>
<ol class="simple">
<li><p>Description of Lake Geneva</p></li>
<li><p>Definition of the locations of interest</p></li>
<li><p>Definition of the set of data</p></li>
</ol>
</li>
<li><p>Data</p>
<ul class="simple">
<li><p>Description of the data generating process</p></li>
<li><p>Assumptions and computational methods</p></li>
</ul>
</li>
<li><p>Statistical methods</p>
<ul class="simple">
<li><p>Estimating the probability of FHP using the Binomial distribution</p></li>
<li><p>Role of condtional probability</p></li>
<li><p>Defining appropriate sources of prior data</p></li>
<li><p>Example: Determining <span class="math notranslate nohighlight">\(\theta_{lake}\)</span> with the survey data</p></li>
</ul>
</li>
</ol>
</li>
<li><p>Results and discussion</p>
<ol class="simple">
<li><p>Example of binomial survey results</p></li>
<li><p>Numerical definition of the priors</p>
<ul class="simple">
<li><p>Possible interpretations of the survey results</p></li>
</ul>
</li>
<li><p>Survey strategy for End Period Plastics</p>
<ul class="simple">
<li><p>Marginal probability and Bayes factor</p></li>
</ul>
</li>
<li><p>Environmental policy implications</p></li>
</ol>
</li>
<li><p>Support materials</p>
<ol class="simple">
<li><p>List of survey locations and results</p></li>
<li><p>Different survey results for different values of <span class="math notranslate nohighlight">\(\theta\)</span></p></li>
<li><p>Scaling the prior</p></li>
<li><p>Bayes factor</p></li>
<li><p>Sampling the posterior distribution</p></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="introduction">
<h2>INTRODUCTION<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>According to a Brief History of Marine Litter, the first scientifically recorded interaction between marine organisms and persistent litter was in 1969 <span id="id1">[<a class="reference internal" href="references.html#id43" title="Peter G. Ryan. A Brief History of Marine Litter Research, pages 1–25. Springer International Publishing, Cham, 2015. URL: https://doi.org/10.1007/978-3-319-16510-3_1, doi:10.1007/978-3-319-16510-3_1.">Rya15</a>]</span>. In 1972 the International Journal of Environmental Studies observed that most of the trash on isolated stretches of ocean shoreline was a result of sea‐borne waste stating that <em>The waste is primarily a by‐product of international commerce and not the behavior of the casual visitor <span id="id2">[<a class="reference internal" href="references.html#id44" title="Professor G Scott. Plastics packaging and coastal pollution. International Journal of Environmental Studies, 3(1-4):35–36, 1972.">Sco72</a>]</span></em>.  This document picks up the trail 50 years later and several hundred miles upstream.  While the harmful effects of plastic are (apparently) debatable, its occurrence on the beach and in the water is undeniable. Volunteers, applying common sense protocols that have been put in place over the past twenty years, have created a very accurate picture of the occurrence of plastics on the beach and on inland lakes and rivers <span id="id3">[<a class="reference internal" href="references.html#id39" title="Alexander G.J. Driedger, Hans H. Dürr, Kristen Mitchell, and Philippe Van Cappellen. Plastic debris in the laurentian great lakes: a review. Journal of Great Lakes Research, 41(1):9-19, 2015. URL: https://www.sciencedirect.com/science/article/pii/S0380133015000064, doi:https://doi.org/10.1016/j.jglr.2014.12.020.">DDMVanCappellen15</a>]</span>.</p>
<p>The United Nations published a first international guide to collecting ocean beach litter in 2008 <span id="id4">[<a class="reference internal" href="references.html#id11" title="Cheshire et all. Unep/ioc guidelines on survey and monitoring of marine litter. UNEP Regional Seas Reports and Studies, 2009.">eall09</a>]</span>. This publication was followed by another guide developed by OSPAR <span id="id5">[<a class="reference internal" href="references.html#id13" title="OSPAR. Guideline for Monitoriing marine litter on the Beaches in the OSPAR Maritime Area. OSPAE, 2010.">OSP10</a>]</span> in 2010 and then, in 2013, the EU published the Guidance on Monitoring Marine Litter in European Seas <span id="id6">[<a class="reference internal" href="references.html#id2" title="George Hanke. Guidance on monitoring of marine litter in european seas. Joint Research Centre of the European Commission, 2013. URL: https://indicit-europa.eu/cms/wp-content/uploads/2017/05/guidance_monitoring_marine_litter_2013.pdf.">Han13</a>]</span>. Riverine Litter Monitoring - Options and Recommendations was published later, in 2016, as evidence was mounting that rivers are major sources of marine litter <span id="id7">[<a class="reference internal" href="references.html#id5" title="Georg Hanke, Daniel González Fernández, Tweehuysen, Bellert, Holzhauer, Andreja Palatinus, Hohenblum, and L. Oosterbaan. Riverine litter monitoring - options and recommendations. publications Office of the European Union, 02 2017. doi:10.2788/461233.">HGFT+17</a>]</span>. As a result, thousands of observations have been collected following two very similar protocols <span id="id8">[<a class="reference internal" href="references.html#id7" title="European Environment Agnecy. Mlw data viewer. 2021. URL: https://www.eea.europa.eu/themes/water/europes-seas-and-coasts/assessments/marine-litterwatch/data-and-results/marine-litterwatch-data-viewer.">Agn21</a>]</span> <span id="id9">[<a class="reference internal" href="references.html#id12" title="OSPAR. Beach litter - abundance, composition and trends. D10 - Marine Litter, 2017.">OSP17</a>]</span>. These data are collected by different organizations, mostly volunteer, throughout the European continent. Each observation is a categorical list of objects and their respective quantities within a defined length of shoreline. The same protocol has been in place in Switzerland since November 2015, targeting regional lakes and rivers. <span id="id10">[<a class="reference internal" href="references.html#id2" title="George Hanke. Guidance on monitoring of marine litter in european seas. Joint Research Centre of the European Commission, 2013. URL: https://indicit-europa.eu/cms/wp-content/uploads/2017/05/guidance_monitoring_marine_litter_2013.pdf.">Han13</a>]</span> <span id="id11">[<a class="reference internal" href="references.html#id13" title="OSPAR. Guideline for Monitoriing marine litter on the Beaches in the OSPAR Maritime Area. OSPAE, 2010.">OSP10</a>]</span>.</p>
<p>The data collected by volunteers were considered fit for the purpose of establishing beach-litter threshold values by the Marine Litter Technical Group of the EU <span id="id12">[<a class="reference internal" href="references.html#id3" title="van Loon W. Hanke G., Walvoort D. Eu marine beach litter baselines. Publications Office of the European Union, 2019. doi:10.2760/16903.">HG19</a>]</span>. However, the lack of quantitative research on the harmful effects of beach litter, specifically the <em>dose-effect</em> relationship between plastic and ecological harm, precludes the establishment of threshold values based on a health related metric. Quantifying the socio-economic effects prove to be just as diificult. Therefore, threshold values and baselines were adopted according to the <em>precautionary principle</em> <span id="id13">[<a class="reference internal" href="references.html#id4" title="Fleet D. Van Loon W., Hanke G. A european threshold value and assessment method for macro litter on coastlines. Publications Office of the European Union, 2020.">VLW20</a>]</span>. In practice, EU threshold values are determined by using the 15th percentile (20 p/100m) from the combined data set of the 2015-2016 beach litter surveys within the EU. <span id="id14">[<a class="reference internal" href="references.html#id4" title="Fleet D. Van Loon W., Hanke G. A european threshold value and assessment method for macro litter on coastlines. Publications Office of the European Union, 2020.">VLW20</a>]</span></p>
<p>The presence of objects on the shoreline has also raised concern in the Life Cycle Assessment (LCA) community. The Life Cycle Initiative (LCI) is a public-private partnership that includes France, Switzerland, Germany and the EU with a stated goal of advancing the understanding of life cycle thinking by private and public decision makers. In partnership with Plastics Europe, LCI has been attempting to integrate potential environmental impacts of marine litter, especially plastic, in Life Cycle Assessment (LCA) results.  <span id="id15">[<a class="reference internal" href="references.html#id10" title="Politécnica Universidad Católica del Perú. Marine impacts in lca (marilca). 2021. URL: https://marilca.org/.">dP21</a>]</span> <span id="id16">[<a class="reference internal" href="references.html#id9" title="UN Environment programme. Life cycle initative. 2021. URL: https://www.lifecycleinitiative.org/.">pro21</a>]</span>. The consequences of plastic leaked into the environment are not accounted for in the current practice of LCA <span id="id17">[<a class="reference internal" href="references.html#id14" title="John S. Woods et all. A framework for the assessment of marine litter impacts in life cycle impact assessment. Ecological Indicators, 129:107918, 2021. URL: https://www.sciencedirect.com/science/article/pii/S1470160X21005835, doi:j.ecolind.2021.107918.">ea21</a>]</span>. This could be for the same reasons that the EU adopted the precautionary principle, as opposed to the dose-effect relationship when developing threshold values.</p>
<p>Considering that the median value was 133 p/100 m in the 2015-2016 beach litter surveys, it means that regional administrations will need to allocate resources to meet the threshold value if they want to achieve good environmental status under the Marine Strategy Framework Directive <span id="id18">[<a class="reference internal" href="references.html#id6" title="European commission. Achieve good environmental status. URL: https://ec.europa.eu/environment/marine/good-environmental-status/index_en.htm.">com</a>]</span>. At the same time, producers are considering the risk of the outcome <em>marine-litter</em> and trying to develop strategies to minimize that risk for their own products <span id="id19">[<a class="reference internal" href="references.html#id15" title="Stefanini R.; Borghesi G.; Ronzano A.; et al. Plastic or glass: a new environmental assessment with a marine litter indicator for the comparison of pasteurized milk bottles. International Journal of Life Cycle Assessment, 2021. doi:s11367-020-01804-x.">eal21</a>]</span> <span id="id20">[<a class="reference internal" href="references.html#id14" title="John S. Woods et all. A framework for the assessment of marine litter impacts in life cycle impact assessment. Ecological Indicators, 129:107918, 2021. URL: https://www.sciencedirect.com/science/article/pii/S1470160X21005835, doi:j.ecolind.2021.107918.">ea21</a>]</span>. Determining which are the most effective and efficient solutions will require that both stakeholders conduct intermediate assessments based on benchmarks to evaluate progress and compare probable outcomes. This requires having adequate statistical tools to make reasonable assumptions based on the data.</p>
<p>EU thresholds and LCAs, are attempts at reducing the probability of an object being found or identified in the marine environment but none answers the general question <em>“How likely is an object to be found?”</em>. End Period Plastics in the UK asked this question in preparation for a meeting with producers of feminine hygiene products (FHP) in Geneva, Switzerland. The team from End Period Plastics was interested in knowing the incidence of these objects in Lake Geneva <span id="id21">[<a class="reference internal" href="references.html#id16" title="World Economic Forum. My fight to remove plastic from period products – and why it matters. 2021. URL: https://www.weforum.org/agenda/2020/11/remove-plastic-from-period-products/.">For21</a>]</span> and allotted three hours of time to do a beach-litter-survey. Tampon applicators and tampons are part of a group of specific items that are found on beaches all over the continent and most likely originate from toilet flushing or wastewater treatment facilities, cotton-swabs are also part of that group. <span id="id22">[<a class="reference internal" href="references.html#id17" title="Oisín Ó Briain, Ana R. Marques Mendes, Stephen McCarron, Mark G. Healy, and Liam Morrison. The role of wet wipes and sanitary towels as a source of white microplastic fibres in the marine environment. Water Research, 2020. URL: https://www.sciencedirect.com/science/article/pii/S0043135420305583, doi:j.watres.2020.116021.">OBriainMarquesMendesM+20</a>]</span> <span id="id23">[<a class="reference internal" href="references.html#id18" title="Allan Williams and S. Simmons. The degradation of plastic litter in rivers: implications for beaches. Journal of Coastal Conservation, 2:63-72, 01 1996. doi:10.1007/BF02743038.">WS96</a>]</span> <span id="id24">[<a class="reference internal" href="references.html#id19" title="François Galgani, Aleke Stöfen-O'Brien, Judith Weis, Christos Ioakeimidis, Qamar Schuyler, Iryna Makarenko, Huw Griffiths, Joan Bondareff, Andre Vethaak, Alan Deidun, Paula Sobral, Konstantinos Topouzelis, Penny Vlahos, Fernanda Lana, Martin Hassellov, Olivia Gerigny, Bera Arsonina, Archis Ambulkar, Maurizio Azzaro, and Maria Bebianno. Are litter, plastic and microplastic quantities increasing in the ocean? Microplastics and Nanoplastics, 01 2021. doi:10.1186/s43591-020-00002-8.">GSOBrienW+21</a>]</span></p>
<p>With the inttention of having a successfull event, succes defined as finding an FHP, hammerdirt staff needed to identify the location that had the highest likelihood of finding an FHP in Geneva. Beach litter monitoring on Lake Geneva started in November 2015 using the MSFD method <span id="id25">[<a class="reference internal" href="references.html#id2" title="George Hanke. Guidance on monitoring of marine litter in european seas. Joint Research Centre of the European Commission, 2013. URL: https://indicit-europa.eu/cms/wp-content/uploads/2017/05/guidance_monitoring_marine_litter_2013.pdf.">Han13</a>]</span> <span id="id26">[<a class="reference internal" href="references.html#id21" title="Shannon et all Erismann. Identification, quantification and analysis of observable anthropogenic litter along swiss freshwater systems¶. Technical Report, hammerdirt, 2021. URL: https://hammerdirt-analyst.github.io/IQAASL-End-0f-Sampling-2021/titlepage.html, doi:10.5281/zenodo.6053926.">Eri21</a>]</span>. Data has been collected at irregular intervals all over the lake using the same protocol by different groups since then. Monitoring is also conducted at the Rhône outflow to the Mediteranean at Port Saint Louis near Marseille, France. The resolution to this problem, depends on recognising that an estimation of risk is requested. What follows is a simple but effective application of the Beta-Binomial conjugate model to litter-survey data from a variety of regions and sources to estimate the risk of encountering an FHP in Geneva. The original question, relevant at all times for all locations and objects, can be solved within a specified range of uncertainty using common analytical and programmatic methods with the data on hand.</p>
</div>
<div class="section" id="data-and-methods">
<h2>DATA AND METHODS<a class="headerlink" href="#data-and-methods" title="Permalink to this headline">¶</a></h2>
<div class="section" id="study-sites">
<h3>Study sites<a class="headerlink" href="#study-sites" title="Permalink to this headline">¶</a></h3>
<p>Lake Geneva is a perialpine lake at an altitude of 372 m above mean sea level located between France and Switzerland. It has an elongated shape, a surface area of 580 km2, and maximum length and width of 72.3 and 14 km, respectively. The average water residence time is 11.3 years. The lake is subdivided into two sub-basins: the Grand Lac (large lake) (309 m deep) and the Petit Lac (small lake) (medium-sized basin with a volume of 3 km3 and a maximum depth of about 70 m.  Lake Geneva is fed by a large number of rivers and streams but most of the water enters through the Rhône River. The permanent population (2011) in its watershed is: 1,083,431 (France: 142,229, Switzerland: 941,202) but also hosts a large tourism population. There are 171 wastewater treatment plants (population equivalent: 3,009,830). <span id="id27">[<a class="reference internal" href="references.html#id20" title="Conseil scientifique. Rapports sur les études et recherches entreprises dans le bassin lémanique. Technical Report, Commission internationale pour la protection des eaux du Léman contre la pollution –CIPEL, Agroscope-Changins -Bâtiment DC50, route de Duillier, CP 1080 CH -1260 Nyon 1, 2019. URL: https://www.cipel.org/wp-content/uploads/2021/06/rapportscientifique-camp-2019.pdf.">sci19</a>]</span></p>
<p>The focus of this study is Geneva beaches (baby-plage, baby-plage-II, Jardin-botanique, rocky-plage, villa-barton), which are located in the Petit Lac (Map 1). However, the method applies to all locations equally, therefore all the available data collected on Lake Geneva, using the same protocol, is considered in the evaluation of the risk <span id="id28">[<a class="reference internal" href="references.html#id21" title="Shannon et all Erismann. Identification, quantification and analysis of observable anthropogenic litter along swiss freshwater systems¶. Technical Report, hammerdirt, 2021. URL: https://hammerdirt-analyst.github.io/IQAASL-End-0f-Sampling-2021/titlepage.html, doi:10.5281/zenodo.6053926.">Eri21</a>]</span>. A reference set of data from the city of Port Saint Louis which is at the mouth of the Rhône where it discharges into the sea will be presented with aggregated results of the lake. <span id="id29">[<a class="reference internal" href="references.html#id36" title="MerTerre association. Beach litter survey results at port saint louis. 2021. URL: https://mer-terre.org/.">ass21</a>]</span>.</p>
<div class="section" id="map-one-survey-locations-in-the-petite-and-grand-lac-november-2015-novemeber-2021">
<h4><strong>Map one: survey locations in the Petite and Grand lac, November 2015 - Novemeber 2021</strong><a class="headerlink" href="#map-one-survey-locations-in-the-petite-and-grand-lac-november-2015-novemeber-2021" title="Permalink to this headline">¶</a></h4>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/chance_of_an_encounter_7_0.jpg" src="_images/chance_of_an_encounter_7_0.jpg" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jfhg</span> <span class="o">=</span> <span class="n">ldb</span><span class="p">[</span><span class="n">ldb</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">code</span><span class="p">)]</span>
<span class="n">jfhg_c</span> <span class="o">=</span> <span class="n">jfhg</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span><span class="s2">&quot;city&quot;</span><span class="p">,</span><span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;quantity&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>

<span class="c1"># select by quantity &gt; 2</span>
<span class="n">qs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">,</span><span class="s1">&#39;four&#39;</span><span class="p">,</span><span class="s1">&#39;five&#39;</span><span class="p">,</span><span class="s1">&#39;six&#39;</span><span class="p">,</span><span class="s1">&#39;seven&#39;</span><span class="p">,</span><span class="s1">&#39;eight&#39;</span><span class="p">,</span><span class="s1">&#39;nine&#39;</span><span class="p">,</span> <span class="s1">&#39;ten&#39;</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">]</span>
<span class="n">qsindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">))</span>
<span class="n">qsindex</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">qsindex</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">aq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qs</span><span class="p">):</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;plus&quot;</span>
    <span class="n">new_column</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">aq</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">jfhg_c</span><span class="p">[</span><span class="n">new_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">jfhg_c</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">qsindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># make fail a boolean for &gt; 0</span>
<span class="n">jfhg_c</span><span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jfhg_c</span><span class="o">.</span><span class="n">fail</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">jfhg_c</span><span class="o">.</span><span class="n">fail</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># label the sampling period for each location</span>
<span class="c1"># assign a period to each sample</span>
<span class="c1"># period one</span>
<span class="n">p_o_s</span> <span class="o">=</span> <span class="s2">&quot;2015-11-15&quot;</span>
<span class="n">p_o_e</span> <span class="o">=</span> <span class="s2">&quot;2017-03-31&quot;</span>

<span class="c1"># period two</span>
<span class="n">p_t_s</span> <span class="o">=</span> <span class="s2">&quot;2017-04-01&quot;</span>
<span class="n">p_t_e</span> <span class="o">=</span> <span class="s2">&quot;2018-05-01&quot;</span>
<span class="n">ptwo</span> <span class="o">=</span> <span class="p">(</span><span class="n">jfhg_c</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">p_t_s</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">jfhg_c</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">p_t_e</span><span class="p">)</span> 
<span class="n">ldbtwo</span> <span class="o">=</span> <span class="p">(</span><span class="n">ldb</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">p_t_s</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ldb</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">p_t_e</span><span class="p">)</span>

<span class="c1"># period three</span>
<span class="n">p_th_s</span> <span class="o">=</span> <span class="s2">&quot;2021-11-01&quot;</span>
<span class="n">pthree</span> <span class="o">=</span> <span class="p">(</span><span class="n">jfhg_c</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p_t_e</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">jfhg_c</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">p_th_s</span><span class="p">)</span>
<span class="n">ldbthree</span> <span class="o">=</span> <span class="p">(</span><span class="n">ldb</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p_t_e</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">ldb</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">p_th_s</span><span class="p">)</span>

<span class="n">jfhg_c</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">jfhg_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ptwo</span><span class="p">,</span> <span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">jfhg_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pthree</span><span class="p">,</span> <span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">ldb</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ldb</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ldbtwo</span><span class="p">,</span> <span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ldb</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ldbthree</span><span class="p">,</span> <span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># aggregate to location</span>
<span class="n">T_locations</span> <span class="o">=</span> <span class="n">jfhg_c</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;loc_date&quot;</span><span class="p">:</span><span class="s2">&quot;nunique&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;plus_two&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>

<span class="c1"># lake totals by period</span>
<span class="n">T_lake</span> <span class="o">=</span> <span class="n">T_locations</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;loc_date&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;plus_two&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>
<span class="n">T_lake</span><span class="p">[</span><span class="s2">&quot;alpha_beta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">T_lake</span><span class="o">.</span><span class="n">fail</span><span class="p">,</span> <span class="n">T_lake</span><span class="o">.</span><span class="n">loc_date</span><span class="p">))</span>
<span class="n">T_lake</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">T_lake</span><span class="o">.</span><span class="n">loc_date</span> <span class="o">-</span> <span class="n">T_lake</span><span class="o">.</span><span class="n">fail</span>
<span class="n">T_lake</span><span class="p">[</span><span class="s2">&quot;alpha_k&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">T_lake</span><span class="o">.</span><span class="n">fail</span><span class="p">,</span> <span class="n">T_lake</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
<span class="n">T_lake</span><span class="p">[</span><span class="s2">&quot;k_plus_two&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">T_lake</span><span class="o">.</span><span class="n">loc_date</span> <span class="o">-</span> <span class="n">T_lake</span><span class="o">.</span><span class="n">plus_two</span>
<span class="n">T_lake</span><span class="p">[</span><span class="s2">&quot;alpha_plus_two&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">T_lake</span><span class="o">.</span><span class="n">plus_two</span><span class="p">,</span> <span class="n">T_lake</span><span class="o">.</span><span class="n">k_plus_two</span><span class="p">))</span>

<span class="n">T_p3</span> <span class="o">=</span> <span class="n">T_lake</span><span class="p">[</span><span class="n">T_lake</span><span class="o">.</span><span class="n">period</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># name the variables</span>
<span class="n">left_bank</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;baby-plage-geneva&quot;</span><span class="p">,</span> <span class="s2">&quot;rocky-plage&quot;</span><span class="p">,</span> <span class="s2">&quot;baby-plage-ii-geneve&quot;</span><span class="p">]</span>
<span class="n">right_bank</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;villa-barton&quot;</span><span class="p">,</span> <span class="s2">&quot;jardin-botanique&quot;</span><span class="p">]</span>

<span class="c1"># geneva totals by location</span>
<span class="n">T_geneva</span> <span class="o">=</span> <span class="n">T_locations</span><span class="p">[</span><span class="n">T_locations</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="o">*</span><span class="n">left_bank</span><span class="p">,</span> <span class="o">*</span><span class="n">right_bank</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">T_glocations</span> <span class="o">=</span>  <span class="n">T_geneva</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;loc_date&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;plus_two&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>

<span class="c1"># geneva totals by left or right bank</span>
<span class="n">T_geneva</span><span class="p">[</span><span class="s2">&quot;bank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
<span class="n">T_geneva</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">T_geneva</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">left_bank</span><span class="p">),</span> <span class="s2">&quot;bank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
<span class="n">T_banks</span> <span class="o">=</span> <span class="n">T_geneva</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;bank&quot;</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;loc_date&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;plus_two&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>

<span class="n">periods</span> <span class="o">=</span> <span class="n">jfhg_c</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span>

<span class="k">def</span> <span class="nf">n_minust</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">periods</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    
    <span class="n">ns_and_ts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">n</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">period</span> <span class="o">==</span> <span class="n">period</span><span class="p">]</span><span class="o">.</span><span class="n">loc_date</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">period</span> <span class="o">==</span> <span class="n">period</span><span class="p">][</span><span class="n">threshold</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="n">n_minus_t</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="n">t</span>
        <span class="n">ns_and_ts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">period</span><span class="p">,</span> <span class="n">n</span> <span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">n_minus_t</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ns_and_ts</span>

<span class="k">def</span> <span class="nf">define_t</span><span class="p">(</span><span class="n">ns_ts</span><span class="p">,</span> <span class="n">make_k</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>    
    
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n_and_t</span> <span class="ow">in</span> <span class="n">ns_ts</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">make_k</span><span class="p">:</span>
            <span class="n">tally</span><span class="o">=</span> <span class="n">n_and_t</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tally</span><span class="o">=</span><span class="n">n_and_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
        <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">n_and_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">n_and_t</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">tally</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">label</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">new_data</span>


<span class="k">def</span> <span class="nf">make_df_from_ns_ts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">n_minust</span><span class="o">=</span><span class="n">n_minust</span><span class="p">,</span> <span class="n">make_k</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        
        <span class="n">ns_ts</span> <span class="o">=</span> <span class="n">n_minust</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">[</span><span class="s2">&quot;column&quot;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]],</span> <span class="n">periods</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">labeled_data</span> <span class="o">=</span> <span class="n">define_t</span><span class="p">(</span><span class="n">ns_ts</span><span class="p">,</span> <span class="n">make_k</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">new_data</span> <span class="o">+=</span> <span class="n">labeled_data</span>
        
    <span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>  
    
    <span class="k">return</span> <span class="n">new_df</span>


<span class="k">def</span> <span class="nf">make_tuples</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;alpha_beta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">beta</span><span class="p">))</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;alpha_beta&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
    
    <span class="k">return</span> <span class="n">data</span>
    

<span class="k">def</span> <span class="nf">update_betas</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">prior_data</span><span class="p">):</span>
    
    <span class="n">updated</span> <span class="o">=</span> <span class="p">(</span><span class="n">prior_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">new_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prior_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">new_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">updated</span>

<span class="k">def</span> <span class="nf">add_up_betas</span><span class="p">(</span><span class="n">array_of_tuples</span><span class="p">,</span> <span class="n">prior</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="n">new_array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array_of_tuples</span><span class="p">)):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">array_of_tuples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
        <span class="n">a_t</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>
        
        <span class="n">update</span> <span class="o">=</span> <span class="p">((</span><span class="n">a_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">prior</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">a_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">prior</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">new_array</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">a_t</span><span class="p">,</span> <span class="n">prior</span><span class="p">,</span> <span class="n">update</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">new_array</span>

<span class="k">def</span> <span class="nf">make_posterior</span><span class="p">(</span><span class="n">array_of_tuples</span><span class="p">,</span> <span class="n">afunc</span><span class="p">,</span> <span class="n">args</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="n">ags</span> <span class="o">=</span> <span class="n">array_of_tuples</span><span class="p">[</span><span class="n">args</span><span class="p">]</span>
    <span class="n">this_dist</span> <span class="o">=</span> <span class="n">afunc</span><span class="p">(</span><span class="n">ags</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ags</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="n">this_dist</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">this_dist</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span> <span class="p">(</span><span class="n">this_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">),</span> <span class="n">this_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.95</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">ags</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">this_dist</span><span class="o">=</span><span class="n">this_dist</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">minimize_alpha_beta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    
    <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu</span><span class="p">,</span> <span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">var</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">make_tuples_from_df</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="p">[],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">make_k</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="n">a</span> <span class="o">=</span> <span class="n">make_df_from_ns_ts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">make_k</span><span class="o">=</span><span class="n">make_k</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">make_tuples</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">make_betas_and_dists</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">prior</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">index</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">args</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="n">a</span> <span class="o">=</span> <span class="n">add_up_betas</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prior</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">make_posterior</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span><span class="p">}</span>
    
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">d</span>

<span class="k">def</span> <span class="nf">make_posterior_and_array_of_results</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">prior</span><span class="o">=</span><span class="p">(),</span> <span class="n">index_arg</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">make_tuples</span><span class="o">=</span><span class="n">make_tuples</span><span class="p">,</span> <span class="n">make_df_from_ns_ts</span><span class="o">=</span><span class="n">make_df_from_ns_ts</span><span class="p">,</span> <span class="n">data_frame</span><span class="o">=</span><span class="s1">&#39;an empty data frame&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="n">make_k</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">collect</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">labelsi</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">new_tuples</span> <span class="o">=</span> <span class="n">make_tuples_from_df</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labelsi</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">make_k</span><span class="o">=</span><span class="n">make_k</span><span class="p">)</span>
            <span class="n">collect</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_tuples</span><span class="p">)</span>        
        
        <span class="n">som_tups</span><span class="p">,</span> <span class="n">dists</span> <span class="o">=</span> <span class="n">make_betas_and_dists</span><span class="p">(</span><span class="n">collect</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">prior</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="n">index_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_tuples</span> <span class="o">=</span> <span class="n">make_tuples</span><span class="p">(</span><span class="n">make_df_from_ns_ts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">make_k</span><span class="o">=</span><span class="n">make_k</span><span class="p">))</span>
        <span class="n">som_tups</span><span class="p">,</span> <span class="n">dists</span> <span class="o">=</span> <span class="n">make_betas_and_dists</span><span class="p">(</span><span class="n">new_tuples</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">prior</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="n">index_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
    
    <span class="k">return</span> <span class="n">som_tups</span><span class="p">,</span> <span class="n">dists</span>

<span class="c1"># an empty dataframe to capture results</span>
<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># threshold</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span>

<span class="n">labelsone</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">T_geneva</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>
<span class="n">labelstwo</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="s2">&quot;bank&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">T_banks</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>

<span class="c1"># define the values for the lake</span>
<span class="n">lake_alpha_k</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lake&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">T_lake</span><span class="o">.</span><span class="n">alpha_k</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
<span class="n">lkx</span> <span class="o">=</span> <span class="n">add_up_betas</span><span class="p">([</span><span class="n">lake_alpha_k</span><span class="p">])</span>
<span class="n">dists_lk</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">make_posterior</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">args</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lkx</span><span class="p">}</span>

<span class="c1"># define the values for period _ three</span>
<span class="n">p3_alpha_k</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lake&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">T_p3</span><span class="o">.</span><span class="n">alpha_k</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
<span class="n">p3x</span> <span class="o">=</span> <span class="n">add_up_betas</span><span class="p">([</span><span class="n">p3_alpha_k</span><span class="p">])</span>
<span class="n">dists_p3</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">make_posterior</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">args</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p3x</span><span class="p">}</span>

<span class="n">prior_one</span> <span class="o">=</span> <span class="n">dists_lk</span><span class="p">[</span><span class="s2">&quot;lake&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>
<span class="n">p3_prior</span> <span class="o">=</span> <span class="n">dists_p3</span><span class="p">[</span><span class="s2">&quot;lake&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>

<span class="c1"># scaled prior</span>
<span class="c1"># get the mean from the lake posterior and set variance to a limit</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">dists_lk</span><span class="p">[</span><span class="s2">&quot;lake&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
<span class="n">var</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># scale the prior for FHP &gt; 0</span>
<span class="n">scaled_prior_one</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">minimize_alpha_beta</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>

<span class="c1"># define the posterior for each sampling period and get the posterior dist for the combined values</span>
<span class="n">g_l_p</span><span class="p">,</span> <span class="n">dists_l</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">T_glocations</span><span class="p">,</span> <span class="n">T_banks</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labelsone</span><span class="p">,</span> <span class="n">labelstwo</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="n">prior_one</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
<span class="n">g_b_p</span><span class="p">,</span> <span class="n">dists_b</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">T_glocations</span><span class="p">,</span> <span class="n">T_banks</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labelsone</span><span class="p">,</span> <span class="n">labelstwo</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>

<span class="c1"># theta with a scaled prior</span>
<span class="n">g_l_lp</span><span class="p">,</span> <span class="n">dists_lp</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">T_glocations</span><span class="p">,</span> <span class="n">T_banks</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labelsone</span><span class="p">,</span> <span class="n">labelstwo</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="n">scaled_prior_one</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>

<span class="c1"># theta with just period three as a prior</span>
<span class="n">g_p3</span><span class="p">,</span> <span class="n">dists_gp3</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">T_glocations</span><span class="p">,</span> <span class="n">T_banks</span><span class="p">],</span>
                                                      <span class="n">beta</span><span class="p">,</span>
                                                      <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labelsone</span><span class="p">,</span> <span class="n">labelstwo</span><span class="p">],</span>
                                                      <span class="n">prior</span><span class="o">=</span><span class="n">p3_prior</span><span class="p">,</span>
                                                      <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
<span class="c1"># theta FHP &gt; 2 solve for the threshold value with scaled prior</span>
<span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;plus_two&quot;</span>

<span class="n">g_l_p2</span><span class="p">,</span> <span class="n">dists_l2</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">T_glocations</span><span class="p">,</span> <span class="n">T_banks</span><span class="p">],</span><span class="n">beta</span><span class="p">,</span>
                                                       <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labelsone</span><span class="p">,</span> <span class="n">labelstwo</span><span class="p">],</span>
                                                       <span class="n">prior</span><span class="o">=</span><span class="n">scaled_prior_one</span><span class="p">,</span>
                                                       <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
<span class="c1"># data for saint sulpice</span>
<span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;fail&quot;</span>
<span class="n">saint_sulpice</span> <span class="o">=</span> <span class="n">dfBeaches</span><span class="p">[</span><span class="n">dfBeaches</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="s1">&#39;Saint-Sulpice (VD)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="c1"># saint sulpice totals by location</span>
<span class="n">T_saint</span> <span class="o">=</span> <span class="n">T_locations</span><span class="p">[</span><span class="n">T_locations</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">saint_sulpice</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">T_slocations</span> <span class="o">=</span>  <span class="n">T_saint</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;loc_date&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;plus_two&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>

<span class="n">labelsSaintSulpice</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">T_saint</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>
<span class="c1"># saint_n_k = make_tuples_from_df(T_slocations, data_frame, labels=labelsSaintSulpice, threshold=threshold, make_k=True)</span>

<span class="n">s_l_p</span><span class="p">,</span> <span class="n">dists_saint_l</span> <span class="o">=</span>  <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">T_slocations</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labelsSaintSulpice</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="n">prior_one</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
<span class="n">s_b_p</span><span class="p">,</span> <span class="n">dists_saint_b</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">T_slocations</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labelsSaintSulpice</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
<span class="n">s_l_pscaled</span><span class="p">,</span> <span class="n">dists_saint_lscaled</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">T_slocations</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labelsSaintSulpice</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="n">scaled_prior_one</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>

<span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;plus_two&quot;</span>
<span class="n">s_l_p2</span><span class="p">,</span> <span class="n">dists_lp2</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">T_slocations</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labelsSaintSulpice</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="n">scaled_prior_one</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<p>Between November 2015 and November 2021 there were 250 beach-litter surveys at 38 different locations, <a class="reference internal" href="#s1"><span class="std std-ref">S1: locations and survey results</span></a>. In total, 78,104 objects were removed and identified, of which 358 objects were either tampons or tampon applicators (0.45) <span id="id30">[<a class="reference internal" href="references.html#id21" title="Shannon et all Erismann. Identification, quantification and analysis of observable anthropogenic litter along swiss freshwater systems¶. Technical Report, hammerdirt, 2021. URL: https://hammerdirt-analyst.github.io/IQAASL-End-0f-Sampling-2021/titlepage.html, doi:10.5281/zenodo.6053926.">Eri21</a>]</span>. FHP were present in 103 samples (41%). There are three separate sampling periods, each sampling period represents an initiative or campaign. The sampling periods are not of the same length nor is the sampling frequency fixed, except for a few specific locations in periods two and three.</p>
<ol class="simple">
<li><p>Project one: 2015-11-15 to 2017-03-01; the first project on Lac Léman (MCBP)</p></li>
<li><p>Project two: 2017-04-01 to 2018-05-01; the Swiss Litter Report (SLR)</p></li>
<li><p>Project three: 2020-03-01 to 2021-11-01; the start of IQAASL up to two weeks before the survey with End Period Plastics</p></li>
</ol>
<p><strong>Assumptions</strong></p>
<ol class="simple">
<li><p>The samples are independent and identically distributed</p></li>
<li><p><span class="math notranslate nohighlight">\(\theta\)</span> is approximately equal for all locations which is the expected value for the lake</p></li>
<li><p>The expected result for the lake, <span class="math notranslate nohighlight">\(\theta_{lake}\)</span>, or the region is the best estimate for locations without samples</p></li>
<li><p>Exchangeability of data <span id="id31">[<a class="reference internal" href="references.html#id22" title="Andrew Gelman. Bayesian Data Analysis - Third edition. Columbia university, 2021. URL: http://www.stat.columbia.edu/~gelman/book/BDA3.pdf, doi:10.1201/b16018.">Gel21</a>]</span></p></li>
</ol>
<p><strong>Computational methods</strong></p>
<p>The Beta - Binomial conjugate model is used to determine the probable ratio of the number of times an object is found versus not found for each location. The Beta distribution is conjugate to the Binomial distribution which results in a proper posterior distribution that can be solved analytically <span id="id32">[<a class="reference internal" href="references.html#id26" title="John K. Kruschke. Doing Bayesian Data Analysis: A Tutorial with R, JAGS,and Stan. Elsevier, 2015.">Kru15</a>]</span>  <span id="id33">[<a class="reference internal" href="references.html#id23" title="Alan Downey. Think Bayes 2ed. Green Tea Press, 201. URL: http://allendowney.github.io/ThinkBayes2/.">Dow01</a>]</span> <span id="id34">[<a class="reference internal" href="references.html#id24" title="Cameron Davidson-Pilon. Bayesian Methods for Hackers. Addison-Wesley Professional, 2021. URL: https://github.com/CamDavidsonPilon/Probabilistic-Programming-and-Bayesian-Methods-for-Hackers, doi:10.5555/2851115.">DP21</a>]</span>. The implementation is done with  SciPy v1.7 <span id="id35">[<a class="reference internal" href="references.html#id35" title="Pauli Virtanen, Ralf Gommers, Travis E. Oliphant, Matt Haberland, Tyler Reddy, David Cournapeau, Evgeni Burovski, Pearu Peterson, Warren Weckesser, Jonathan Bright, Stéfan J. van der Walt, Matthew Brett, Joshua Wilson, K. Jarrod Millman, Nikolay Mayorov, Andrew R. J. Nelson, Eric Jones, Robert Kern, Eric Larson, C J Carey, İlhan Polat, Yu Feng, Eric W. Moore, Jake VanderPlas, Denis Laxalde, Josef Perktold, Robert Cimrman, Ian Henriksen, E. A. Quintero, Charles R. Harris, Anne M. Archibald, Antônio H. Ribeiro, Fabian Pedregosa, Paul van Mulbregt, and SciPy 1.0 Contributors. SciPy 1.0: Fundamental Algorithms for Scientific Computing in Python. Nature Methods, 17:261–272, 2020. doi:10.1038/s41592-019-0686-2.">VGO+20</a>]</span> and pandas v1.34 <span id="id36">[<a class="reference internal" href="references.html#id33" title="The pandas development team. Pandas-dev/pandas: pandas. Python software, 2020. URL: https://doi.org/10.5281/zenodo.3509134, doi:10.5281/zenodo.3509134.">pdt20</a>]</span> all running in a Python v3.7 <span id="id37">[<a class="reference internal" href="references.html#id34" title="Guido Van Rossum and Fred L. Drake. Python 3 Reference Manual. CreateSpace, Scotts Valley, CA, 2009. ISBN 1441412697.">VRD09</a>]</span> environment.</p>
<p>The data and methods are available in the repository: <a class="reference external" href="https://github.com/hammerdirt-analyst/finding-one-object">https://github.com/hammerdirt-analyst/finding-one-object</a></p>
</div>
</div>
<div class="section" id="statistical-methods">
<h2>Statistical methods<a class="headerlink" href="#statistical-methods" title="Permalink to this headline">¶</a></h2>
<p>The <strong>Beta - Binomial conjugate model</strong> is developed in the context of the beach-litter survey data in <em>Eqs.(1-17)</em>. The Binomial distribution <em>Eqs.(1-3)</em> can be used to approximate the discrete probability distribution of the number of times that an FHP was found given the number of beach-litter surveys completed. The results of the beach litter surveys can be described by the probability mass function (PMF) of the Binomial ditribution, let T be a random binomial variable and <em>let t = 1 = an FHP was found</em>, or <em>t = 0 = an FHP was not found</em> and let <em>n = the number of surveys</em> <em>Eq.(1)</em>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
T = f(t,n,\theta) = Pr(t; n, \theta) = Pr(X=t) &amp;= {n\choose t}\theta^t(1-\theta)^{n-t},\quad 0\leq t\leq n, n\geq 0,\quad \theta= t/n \tag{1} \\[12pt]
&amp;= {250\choose 103}\theta^{103}(1-\theta)^{250-103} \tag{2} \\[12pt]
&amp;= \theta^{103}(1-\theta)^{147} \tag{3}
\end{align}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[ E[T] = 103,\ Var(T) = 61 \]</div>
<p>The value of <span class="math notranslate nohighlight">\(\theta\)</span> is not given in the data, in most cases it is assumed to be <span class="math notranslate nohighlight">\(\approxeq\)</span>  t/n. Substituting in the values from the data <em>Eq.(2)</em> and assuming that <span class="math notranslate nohighlight">\(\theta\)</span> = t/n results in an expected value of 103 positive samples with variance of +/- 61 samples. However the true value of <span class="math notranslate nohighlight">\(\theta\)</span>, if one exists, is most likely different than the survey results. For example if the true value of <span class="math notranslate nohighlight">\(\theta\)</span> is equal to 0.3 then the expected number of positive surveys would be <span class="math notranslate nohighlight">\(\approxeq\)</span> 75, <a class="reference internal" href="#s2"><span class="std std-ref">S2: changes in the value of t/n</span></a>, which could have easily ocurred given the expected variance of T = <span class="math notranslate nohighlight">\(E[Var(T)]\)</span> = 61. To get an answer for <span class="math notranslate nohighlight">\(\theta\)</span> from the data, which is the quantity in question, consider that: (i) <span class="math notranslate nohighlight">\(\theta\)</span> is a random variable, (ii) <span class="math notranslate nohighlight">\(\theta\)</span> is defined between 0 and 1 (iii) <span class="math notranslate nohighlight">\(\theta\)</span> is a ratio of the sample space (iiii) <span class="math notranslate nohighlight">\(\theta\)</span> depends on the survey results <span id="id38">[<a class="reference internal" href="references.html#id23" title="Alan Downey. Think Bayes 2ed. Green Tea Press, 201. URL: http://allendowney.github.io/ThinkBayes2/.">Dow01</a>]</span> <span id="id39">[<a class="reference internal" href="references.html#id41" title="Edwind Jaynes. Probability Theory: The logic of science. Washington University, 2003. ISBN 0521592712.">Jay03</a>]</span>. Therefore the expected values of T and <span class="math notranslate nohighlight">\(\theta\)</span> are conditional probabilities where the value of one could change the value of the other <em>Eq.(4)</em>. Solving <em>Eq.(4)</em> for <span class="math notranslate nohighlight">\(\theta\)</span> gives <em>Eq.(5)</em>, which allows the inference of <span class="math notranslate nohighlight">\(\theta\)</span> from the data.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
P(T|\theta) &amp;= \frac{P(\theta|T)P(T)}{P(\theta)} \tag{4} \\[12pt]
P(\theta|T) &amp;= \frac{P(T|\theta)P(\theta)}{P(T)} \tag{5} \\[12pt]
Posterior\ distribution &amp;= \frac{Likelihood\ *\ Prior}{Marginal\ probability} \tag{6} \\[12pt]
\end{align}
\end{split}\]</div>
<p>Probability notation is deceptively easy to resolve and the notion of prior knowledge is captured in the second expression of the numerator <span class="math notranslate nohighlight">\(P(T)\)</span>  <em>Eq.(4)</em> or <span class="math notranslate nohighlight">\(P(\theta)\)</span>  <em>Eq.(5)</em>  which is the key to Bayes rule <em>Eqs.(4-6)</em>. The prior relates any appropriate additional information about the unknown variable to the current likelihood <em>Eq.(6)</em> <span id="id40">[<a class="reference internal" href="references.html#id41" title="Edwind Jaynes. Probability Theory: The logic of science. Washington University, 2003. ISBN 0521592712.">Jay03</a>]</span> <span id="id41">[<a class="reference internal" href="references.html#id22" title="Andrew Gelman. Bayesian Data Analysis - Third edition. Columbia university, 2021. URL: http://www.stat.columbia.edu/~gelman/book/BDA3.pdf, doi:10.1201/b16018.">Gel21</a>]</span> <span id="id42">[<a class="reference internal" href="references.html#id26" title="John K. Kruschke. Doing Bayesian Data Analysis: A Tutorial with R, JAGS,and Stan. Elsevier, 2015.">Kru15</a>]</span>. The posterior distribution is the result of combining the prior with the likelihood and dividing the product by the <em>marginal probability</em> of T <em>Eq.(6)</em>. The term prior is by convention and does not imply that the information was obtained prior to the samples <span id="id43">[<a class="reference internal" href="references.html#id41" title="Edwind Jaynes. Probability Theory: The logic of science. Washington University, 2003. ISBN 0521592712.">Jay03</a>]</span>. Rather than assume the value of <span class="math notranslate nohighlight">\(\theta\)</span> is t/n,  it can be inferred or estimated from the data using <em>Eq.(5)</em>.</p>
<p><strong>Prior knowledge</strong></p>
<p>While the definition of the prior could allow for the introduction of arbitrary data, <em>in this analysis it is restricted to the provided beach-litter survey results or if there are no survey results then the prior information is considered uninformative</em>. As an example consider the state of knowledge about the incidence of FHP before sampling started on Lake Geneva. Prior to 2015 there was no organized data collection of beach litter, the presence of litter had been established but the quantities were given in kilograms and used primarily for awareness campaigns. From this it could be infered that the prior probability of FHP was &gt; 0 and &lt; 1, any assumption beyond that could not be supported. Thus, the <em>prior</em> to November 2015 is the uniform probability distribution defined as <span class="math notranslate nohighlight">\(Beta(\alpha=1, \beta=1)\)</span>. <span id="id44">[<a class="reference internal" href="references.html#id23" title="Alan Downey. Think Bayes 2ed. Green Tea Press, 201. URL: http://allendowney.github.io/ThinkBayes2/.">Dow01</a>]</span> <span id="id45">[<a class="reference internal" href="references.html#id28" title="James Berger. A catalog of noninformative priors. none, 1998. URL: http://www.stats.org.uk/priors/noninformative/YangBerger1998.pdf.">Ber98</a>]</span> <span id="id46">[<a class="reference internal" href="references.html#id41" title="Edwind Jaynes. Probability Theory: The logic of science. Washington University, 2003. ISBN 0521592712.">Jay03</a>]</span> <span id="id47">[<a class="reference internal" href="references.html#id29" title="Telba Z. Irony. Non-informative priors do not exist. Journal of Statistical Planning and Inference, 1997. URL: https://www.uv.es/~bernardo/1997JSPI.pdf.">Iro97</a>]</span></p>
<p>Recall that assumptions two and three state that the expected value for the lake is the expected value for all locations and in the abscence of data then the expected value of the lake is the best estimate for any unique location. This means that the survey results from the rest of the lake should be considered when evaluating <span class="math notranslate nohighlight">\(P(\theta)\)</span> for a unique location. The <strong>prior</strong> is one method for introducing this additional knowledge into the assessment of <span class="math notranslate nohighlight">\(P(\theta)\)</span> at any specific location. How the prior data is incorporated and the impact on the assessment of <span class="math notranslate nohighlight">\(P(\theta)\)</span> for individual survey locations is covered in the results and discussion section.</p>
<p><strong>The probability of <span class="math notranslate nohighlight">\(\theta\)</span> given the data</strong></p>
<p>In a Bayesian model if the posterior distribution <span class="math notranslate nohighlight">\(P(\theta|T)\)</span> is in the same family as the prior distribution <span class="math notranslate nohighlight">\(P(\theta)\)</span> then they are called <em>conjugate distributions</em>. The result is a closed form expression that does not involve numerical integration <span id="id48">[<a class="reference internal" href="references.html#id22" title="Andrew Gelman. Bayesian Data Analysis - Third edition. Columbia university, 2021. URL: http://www.stat.columbia.edu/~gelman/book/BDA3.pdf, doi:10.1201/b16018.">Gel21</a>]</span> <span id="id49">[<a class="reference internal" href="references.html#id41" title="Edwind Jaynes. Probability Theory: The logic of science. Washington University, 2003. ISBN 0521592712.">Jay03</a>]</span>. Using   <em>Eq.(5)</em> and substituting in values for the <em>Likelihood</em>  <em>Eq.(7)</em> and the <em>Prior</em>  <em>Eq.(8)</em>, the product of the numerator  <em>Eq.(9)</em> can be obtained by combining the like terms and adding up the exponents  <em>Eq.(10)</em>. Even though data has been added to the equation through the prior, the result is the same as  <em>Eq.(3)</em>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\text{Likelihood} &amp;= {250\choose 103}\theta^{103} (1-\theta)^{250-103} \tag{7} \\[12pt]
\text{Prior} &amp;= \frac{1}{Beta(1,1)}\theta^{1-1}(1-\theta)^{1-1} \tag{8} \\[12pt]
\text{Likelihood * Prior} &amp;= \frac{1}{Beta(1, 1)} {250\choose 103} \theta^{1 + 103-1}(1-\theta)^{1 + 250 - 103 -1} \tag{9} \\[12pt]
&amp;= \theta^{103}(1-\theta)^{147} \tag{10} \\[12pt]
\end{align}
\end{split}\]</div>
<p>The form of equation  <em>Eq.(10)</em> is the same as  <em>Eq.(3)</em> not including the constants. Determining the <em>marginal probability</em> of T  <em>Eq.(6)</em> requires integrating  <em>Eq.(10)</em>, creating a normalizing constant that ensures the area under the curve defined by  <em>Eq.(10)</em> sums to one. Recall the identity <span class="math notranslate nohighlight">\(\frac{1}{Beta(\alpha,\beta)} = \frac{\Gamma(\alpha + \beta)}{\Gamma(\alpha)\Gamma(\beta)}\)</span> and that the integral of the Beta distribution = 1 by definition <span id="id50">[<a class="reference internal" href="references.html#id37" title="Eric W. Weisstein. Beta distribution. from mathworld–a wolfram web resource. 2021. URL: https://mathworld.wolfram.com/BetaDistribution.html.">Wei21</a>]</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\text{Marginal probability} &amp;= P(T) \tag{11} \\[12pt]
&amp;= \int_{0}^{1} f(\theta)g(t|\theta) d\theta \tag{12} \\[12pt]
&amp;= \frac{1}{Beta(1, 1)} {250\choose 103} \int_{0}^{1} \theta^{103}(1-\theta)^{147} d\theta \tag{13} \\[12pt]
&amp;= \frac{1}{Beta(1, 1)} {250\choose 103} \frac{\Gamma(104) \Gamma(148)}{\Gamma(252)} \tag{14} \\[12pt]
\end{align}
\end{split}\]</div>
<p>The posterior distirbution is solved by recognising that the constants cancel <em>Eq.(15)</em> and dividing the numerator by the integral of the Beta distribution. The resulting expression is another Beta distribution <em>Eq.(17)</em>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\text{Posterior distribution} &amp;= \frac{
                        \frac{1}{Beta(1, 1)} {250\choose 103} \theta^{103}(1-\theta)^{147}
                        }
                        {
                        \frac{1}{Beta(1, 1)} {250\choose 103} \frac{\Gamma(104) \Gamma( 148)}{\Gamma(252)}
                        } \tag{15} \\[14pt]
&amp;= \frac{\Gamma(252)}{\Gamma(104) \Gamma(148)}\theta^{103}(1-\theta)^{147} \tag{16} \\[12pt]
&amp;= \frac{1}{Beta(104, 148)} \theta^{103}(1-\theta)^{147} \tag{17} \\[12pt]
\end{align}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[P(\theta_{lake}|T) = Beta(103, 147),\ E[\theta_{lake}] = 0.41,\ Var(\theta_{lake}) = .001\]</div>
<p>The expression for the posterior distribution P(<span class="math notranslate nohighlight">\(\theta\)</span>|T)  <em>Eq.(17)</em> is in the same form as the prior  <em>Eq.(8)</em> and includes the parameters from both the <em>prior</em> and the <em>likelihood</em>. This property is part of the definition of conjugacy and means that updating the value P(<span class="math notranslate nohighlight">\(\theta\)</span>|T) can be done using the <em>prior</em> in a straightforward, transparent and predictable manner. Most importantly the answer to the original question is provided directly and requires no further manipulation of the data. Given assumption two, the results from <em>Eq.(17)</em> should be considered an initial assessment of the probability of finding an FHP in Geneva. This process is repeated for each location that has survey data on the lake, using these initial aggregated survey results as the prior. All of the probability distributions and their respective PMFs or PDFs that have been used so far are included in the SciPy package <span id="id51">[<a class="reference internal" href="references.html#id35" title="Pauli Virtanen, Ralf Gommers, Travis E. Oliphant, Matt Haberland, Tyler Reddy, David Cournapeau, Evgeni Burovski, Pearu Peterson, Warren Weckesser, Jonathan Bright, Stéfan J. van der Walt, Matthew Brett, Joshua Wilson, K. Jarrod Millman, Nikolay Mayorov, Andrew R. J. Nelson, Eric Jones, Robert Kern, Eric Larson, C J Carey, İlhan Polat, Yu Feng, Eric W. Moore, Jake VanderPlas, Denis Laxalde, Josef Perktold, Robert Cimrman, Ian Henriksen, E. A. Quintero, Charles R. Harris, Anne M. Archibald, Antônio H. Ribeiro, Fabian Pedregosa, Paul van Mulbregt, and SciPy 1.0 Contributors. SciPy 1.0: Fundamental Algorithms for Scientific Computing in Python. Nature Methods, 17:261–272, 2020. doi:10.1038/s41592-019-0686-2.">VGO+20</a>]</span> and can be implemented in an itterative process. How the beach litter data is used to update the expected value for each location and how <span class="math notranslate nohighlight">\(P(\theta_{lake})\)</span> is used to determinine the risk of encountering an object at specific locations is addressed in the next section.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ldb_p3</span> <span class="o">=</span> <span class="n">ldb</span><span class="p">[</span><span class="n">ldbthree</span><span class="p">]</span>

<span class="n">total_p3</span> <span class="o">=</span> <span class="n">ldb_p3</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">samp_p3</span> <span class="o">=</span> <span class="n">ldb_p3</span><span class="o">.</span><span class="n">loc_date</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>

<span class="n">genf</span> <span class="o">=</span> <span class="n">ldb</span><span class="p">[(</span><span class="n">ldbthree</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">ldb</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">code</span><span class="p">))]</span>
<span class="n">g_found</span> <span class="o">=</span> <span class="n">genf</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">})</span>
<span class="n">g_found</span><span class="p">[</span><span class="n">g_found</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;quantity&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;loc_date&quot;</span><span class="p">:</span><span class="s2">&quot;nunique&quot;</span><span class="p">})</span>

<span class="n">g144</span> <span class="o">=</span> <span class="n">genf</span><span class="p">[(</span><span class="n">genf</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s2">&quot;G144&quot;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">genf</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
<span class="n">g96</span> <span class="o">=</span> <span class="n">genf</span><span class="p">[(</span><span class="n">genf</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s2">&quot;G96&quot;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">genf</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
<span class="c1"># both = genf[(genf.code.isin(</span>

<span class="n">only_144</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">g144</span><span class="o">.</span><span class="n">loc_date</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">g96</span><span class="o">.</span><span class="n">loc_date</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="n">only_96</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">g96</span><span class="o">.</span><span class="n">loc_date</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">g144</span><span class="o">.</span><span class="n">loc_date</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="n">together</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">g144</span><span class="o">.</span><span class="n">loc_date</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">g96</span><span class="o">.</span><span class="n">loc_date</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>

<span class="n">ratio_q</span> <span class="o">=</span> <span class="p">(</span><span class="n">g144</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">g96</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">/</span><span class="n">total_p3</span>
<span class="n">ratio_s</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">only_144</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">only_96</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">together</span><span class="p">))</span><span class="o">/</span><span class="n">samp_p3</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">only_144</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">only_96</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">together</span><span class="p">))</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">samp_p3</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">alpha</span>

<span class="n">p3_dist</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

<span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="n">p3_dist</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">p3_dist</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span> <span class="p">(</span><span class="n">p3_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">),</span> <span class="n">p3_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.95</span><span class="p">))</span>

<span class="n">find_together</span> <span class="o">=</span> <span class="p">(</span><span class="n">genf</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">together</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]))</span><span class="o">&amp;</span><span class="p">(</span><span class="n">genf</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">together</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

<span class="n">found_together</span> <span class="o">=</span> <span class="n">genf</span><span class="p">[</span><span class="n">find_together</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="results-and-discussion">
<h2>Results and discussion<a class="headerlink" href="#results-and-discussion" title="Permalink to this headline">¶</a></h2>
<p>For the last sampling period, ending November 2021, 81 applicators (G96) and 14 tampons (G144) were identified out of 31’202 objects or 0.003 of all objects counted. At least one FHP was identified in 42 out of 109 samples or t/n = .385, within the 90% interval of <span class="math notranslate nohighlight">\(\theta_{lake}\)</span>. The results for Geneva proper are summarized by the five locations with samples and a cumulative tally for the left and right bank, Table 1. <span id="id52">[<a class="reference internal" href="references.html#id46" title="hammerdirt. Zenodo id. 2022. URL: http://example.com.">ham22</a>]</span></p>
<div class="math notranslate nohighlight">
\[ \text{Table 1}: \text{t,n at the end of each sampling period for Geneva beaches.} \]</div>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>location</p></th>
<th class="text-align:center head"><p>period 1 (t,n)</p></th>
<th class="text-align:center head"><p>period 2 (t,n)</p></th>
<th class="text-align:center head"><p>period 3 (t,n)</p></th>
<th class="text-align:center head"><p>total (t,n)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>left-bank</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(3, 14)</p></td>
<td class="text-align:center"><p>(3, 14)</p></td>
</tr>
<tr class="row-odd"><td><p>right-bank</p></td>
<td class="text-align:center"><p>(3, 13)</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(1, 2)</p></td>
<td class="text-align:center"><p>(4, 15)</p></td>
</tr>
<tr class="row-even"><td><p>jardin-botanique</p></td>
<td class="text-align:center"><p>(2, 3)</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(2, 3)</p></td>
</tr>
<tr class="row-odd"><td><p>villa-barton</p></td>
<td class="text-align:center"><p>(1, 10)</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(1, 2)</p></td>
<td class="text-align:center"><p>(2, 12)</p></td>
</tr>
<tr class="row-even"><td><p>baby-plage-geneva</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(3, 11)</p></td>
<td class="text-align:center"><p>(3, 11)</p></td>
</tr>
<tr class="row-odd"><td><p>rocky_plage</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(0, 1)</p></td>
<td class="text-align:center"><p>(0, 1)</p></td>
</tr>
<tr class="row-even"><td><p>baby-plage-ii-geneve</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(0, 0)</p></td>
<td class="text-align:center"><p>(0, 2)</p></td>
<td class="text-align:center"><p>(0, 2)</p></td>
</tr>
</tbody>
</table>
<p><strong>Defining the priors and the model</strong></p>
<p>There are now two estimates for <span class="math notranslate nohighlight">\(\theta\)</span>: (i) <span class="math notranslate nohighlight">\(\theta_{lake}\)</span> and (ii) <span class="math notranslate nohighlight">\(\theta_{period-3}\)</span>, where <span class="math notranslate nohighlight">\(E[\theta_{period-3}]\)</span> is within the 90% HDI of <span class="math notranslate nohighlight">\(E[\theta_{lake}]\)</span>. If the results are grouped according to survey location (Table 1) there are five different estimates for <span class="math notranslate nohighlight">\(\theta_{location}\)</span> in Geneva. The basic assumption is that <span class="math notranslate nohighlight">\(\theta_{lake}\)</span> has an effect on <span class="math notranslate nohighlight">\(\theta_{location}\)</span> (assumtpions 2 and 3) but the magnitude of that effect is unknown. To account for that uncertainty the values of the parameters for <span class="math notranslate nohighlight">\(\theta_{lake}\)</span> will be considered under the two conditions defined by the relationship in <em>Eq.(18)</em> <a class="reference internal" href="#s3"><span class="std std-ref">S3: scaling the prior</span></a>.</p>
<div class="math notranslate nohighlight">
\[\theta_{lake} = E[Beta(104,148)] \approxeq .41 \approxeq E[Beta(9.59, 13.64)] = \theta_{scaled} \tag{18}\]</div>
<p>The probability of finding an object at any particular location given a set of beach-litter-data could be defined according to (19). Depending on how relavent the cumulative data is depends on the size of the paramaters used in the <strong>prior</strong>. In the lake example  <em>Eqs.(7-15)</em> <span class="math notranslate nohighlight">\(Beta(1, 1)\)</span> was used to define the prior for the aggregate value of all the lake data. By considering the uninformed prior it is possible to see how the different regional values effect the posterior distribution for a single location, Tables 2-5, and Figures 1 - 4.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
P(\theta_{location} | Data) = \frac{P(Data | \theta_{location})P(\theta_{l})}{P(Data)},  
P(\theta_{l}) = 
\begin{cases} 
\text{case 1} = Beta(104,148), &amp; \text{lake values} \\ 
\text{case 2} = Beta(9.59, 13.64), &amp; \text{scaled} \\ 
\text{case 3} = Beta(42, 67), &amp; \text{period three} \\ 
\text{case 4} = Beta(1,1), &amp; \text{uninformed} \\ 
\end{cases}
\tag{19} \\
\end{align}
\end{split}\]</div>
<p>Considering the map of surface currents of Lake Geneva <span id="id53">[<a class="reference internal" href="references.html#id45" title="EAWAG. Eawag - aquatic research. 2022. URL: http://meteolakes.ch/#!/hydro/geneva.">EAW22</a>]</span>, the topography of the shoreline and the density of plastic tampon applicators <span id="id54">[<a class="reference internal" href="references.html#id39" title="Alexander G.J. Driedger, Hans H. Dürr, Kristen Mitchell, and Philippe Van Cappellen. Plastic debris in the laurentian great lakes: a review. Journal of Great Lakes Research, 41(1):9-19, 2015. URL: https://www.sciencedirect.com/science/article/pii/S0380133015000064, doi:https://doi.org/10.1016/j.jglr.2014.12.020.">DDMVanCappellen15</a>]</span>, it is reasonable to assume that regional differences could be very significant. There is also large disparity for the value of n at any specific location with regards to aggregate values. This difference can best be seen by comparing Figure 3 to Figure 1, where the average values for all locations are drawn to <span class="math notranslate nohighlight">\(E[\theta_{lake}]\)</span> and it is almost impossible to tell the difference between each location in Figure 1, but in figure three it seems that uncertainty is maximized.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datas</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dists_l</span><span class="p">,</span>  <span class="n">dists_lp</span><span class="p">,</span> <span class="n">dists_b</span><span class="p">,</span> <span class="n">dists_gp3</span><span class="p">]</span>
<span class="n">data_tuples</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_l_p</span><span class="p">,</span> <span class="n">g_l_lp</span><span class="p">,</span> <span class="n">g_b_p</span><span class="p">,</span> <span class="n">g_p3</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">make_tables_from_different_priors</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;interval&quot;</span><span class="p">],</span> <span class="n">places</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="n">orient</span><span class="p">)[</span><span class="n">columns</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;interval&quot;</span><span class="p">:</span>
            <span class="n">a</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">places</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            
        
    <span class="n">table_data</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">table_data</span>
<span class="k">def</span> <span class="nf">make_a_summary_table</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span><span class="n">colLabels</span><span class="p">,</span> <span class="n">a_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">coded_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">codes</span><span class="o">=</span><span class="p">[]):</span>
    
    <span class="sd">&quot;&quot;&quot;Formats matplotlib table object.</span>

<span class="sd">    Args:</span>
<span class="sd">    ax: object: matplotlib table object</span>
<span class="sd">    data: array: the 2d array used to generate the table object</span>
<span class="sd">    cols_to_use: array: the list of column names</span>
<span class="sd">    a_color: str: matplotlib named color, face and edgecolor of table cells</span>
<span class="sd">    font_size: int: the font size for the table cells</span>
<span class="sd">    s_et_bottom_row: bool: whether or not to draw bottom line on the last row</span>

<span class="sd">    Returns:</span>
<span class="sd">    The table object formatted.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">auto_set_font_size</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">the_cells</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_celld</span><span class="p">()</span>

    <span class="n">line_color</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">a_color</span><span class="p">)</span>
    <span class="n">banded_color</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">line_color</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="c1"># the different areas of formatting</span>
    <span class="n">top_row</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colLabels</span><span class="p">))]</span>
    <span class="n">data_rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">the_cells</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_row</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">coded_labels</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a_cell</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_row</span><span class="p">):</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            
            <span class="n">cell_color</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">codes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">c_color</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">cell_color</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.6</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">c_color</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span> <span class="mf">.4</span><span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>        
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a_cell</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_row</span><span class="p">):</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">visible_edges</span> <span class="o">=</span> <span class="s2">&quot;closed&quot;</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_text_props</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="n">font_size</span><span class="p">})</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span> <span class="n">banded_color</span><span class="p">)</span>
            
            
            <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">PAD</span> <span class="o">=</span> <span class="mf">.2</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span><span class="mf">.5</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">a_cell</span> <span class="ow">in</span> <span class="n">data_rows</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span><span class="mf">.5</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">visible_edges</span> <span class="o">=</span> <span class="s2">&quot;BT&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_text_props</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="n">font_size</span><span class="o">-</span><span class="mi">2</span><span class="p">})</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">banded_color</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">_text</span><span class="o">.</span><span class="n">set_horizontalalignment</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">a_cell</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span> <span class="o">=</span> <span class="mf">.6</span>  

    <span class="k">return</span> <span class="n">ax</span>


<span class="n">new_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_tables_from_different_priors</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">datas</span><span class="p">]</span>
<span class="n">chart_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Table 2: prior= lake, &quot;</span><span class="p">,</span> <span class="s2">&quot;Tabel 3: prior= scaled &quot;</span><span class="p">,</span>   <span class="s2">&quot;Table 4: prior= uninformed&quot;</span><span class="p">,</span>   <span class="s2">&quot;Table 5: prior= period three&quot;</span><span class="p">,]</span>

<span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

<span class="n">chart_axs</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">some_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_data</span><span class="p">):</span>
    <span class="n">row</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="n">chart_axs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">ax</span>  <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
    <span class="n">a_simple_formatted_table</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">some_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">colLabels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">some_data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;[.05, .95]&quot;</span><span class="p">],</span> <span class="n">a_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">.4</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="mf">.2</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">],</span> <span class="n">coded_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">remove_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">remove_ticks</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">chart_titles</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chance_of_an_encounter_13_0.png" src="_images/chance_of_an_encounter_13_0.png" />
</div>
</div>
<p>The posterior distribution should be a compromise between the prior and the likelihood <span id="id55">[<a class="reference internal" href="references.html#id41" title="Edwind Jaynes. Probability Theory: The logic of science. Washington University, 2003. ISBN 0521592712.">Jay03</a>]</span> <span id="id56">[<a class="reference internal" href="references.html#id25" title="Alicia Johnson. Bayes Rules! An Introduction to Applied Bayesian Modeling. Chapman and Hall, 2021. URL: https://www.bayesrulesbook.com/chapter-1.html.">Joh21</a>]</span>. The results in table two and table five have similar characteristics, with the mean value shifted to the left three points. The variance and the 90% HDI are essentialy the same at each location as a result there is very little difference in the mean value between each location. This would be a very litteral interpretation of assumption two, that effectvely minimizes the significance of the local survey results in relation to the aggregated results. For generalizing the conditions on the lake this is an adequate estimation and the results in Table 2 are reassuring because they all fall within the range of expected values predicted in the previous section. At the local level under case 4, Table 4 and Figure 3, the results are more heterogenous.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quad_plots</span><span class="p">(</span><span class="n">datas</span><span class="p">,</span> <span class="n">chart_titles</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">names_toc</span><span class="p">,</span> <span class="n">suptitle</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)):</span>
               
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">chart_axs</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">some_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datas</span><span class="p">):</span>

        <span class="n">row</span><span class="o">=</span><span class="n">j</span><span class="o">%</span><span class="k">2</span>
        <span class="n">col</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="o">%</span><span class="k">1</span>.5+.5)
        <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">chart_axs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>

            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmean</span> <span class="o">=</span> <span class="n">some_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;interval&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">some_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;interval&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">some_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>

            <span class="n">odds_against</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xmean</span><span class="p">)</span><span class="o">/</span><span class="n">xmean</span>
            <span class="n">odds_for</span> <span class="o">=</span> <span class="n">xmean</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xmean</span><span class="p">)</span>

            <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
            <span class="n">my_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">.35</span><span class="p">,</span><span class="mf">.45</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

            <span class="n">abeta</span> <span class="o">=</span> <span class="n">some_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;this_dist&quot;</span><span class="p">]</span>
            <span class="n">new_args</span> <span class="o">=</span> <span class="n">some_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">new_args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.999</span><span class="p">,</span> <span class="n">new_args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]:</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span>
                

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">new_args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_args</span><span class="p">[</span><span class="mi">1</span><span class="p">],),</span> <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">names_toc</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">chart_titles</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>           
            
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>   
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">x_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">.1</span><span class="p">)</span>
        <span class="n">x_ticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_ticks</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">x_ticklabels</span><span class="p">)</span>            

    <span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mf">.55</span><span class="p">,</span><span class="mf">.5</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">suptitle</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># declare variables for charting</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;jardin-botanique&quot;</span><span class="p">,</span> <span class="s2">&quot;villa-barton&quot;</span><span class="p">,</span> <span class="s2">&quot;baby-plage-geneva&quot;</span><span class="p">,</span> <span class="s2">&quot;rocky-plage&quot;</span><span class="p">,</span> <span class="s2">&quot;baby-plage-ii-geneve&quot;</span><span class="p">]</span>
<span class="n">names_toc</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="o">*</span><span class="n">names</span><span class="p">])}</span>
<span class="n">chart_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Figure 1: prior= lake, &quot;</span><span class="p">,</span> <span class="s2">&quot;Figure 2: prior= scaled &quot;</span><span class="p">,</span>   <span class="s2">&quot;Figure 3: prior= uninformed&quot;</span><span class="p">,</span>   <span class="s2">&quot;Figure 4: prior= period three&quot;</span><span class="p">,]</span>
<span class="n">datas</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dists_l</span><span class="p">,</span>  <span class="n">dists_lp</span><span class="p">,</span> <span class="n">dists_b</span><span class="p">,</span> <span class="n">dists_gp3</span><span class="p">]</span>
<span class="n">suptitle</span> <span class="o">=</span> <span class="s2">&quot;Probability of FHP Lake Geneva, Geneva, Switzerland&quot;</span>

<span class="n">quad_plots</span><span class="p">(</span><span class="n">datas</span><span class="p">,</span> <span class="n">chart_titles</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">names_toc</span><span class="p">,</span> <span class="n">suptitle</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chance_of_an_encounter_15_0.png" src="_images/chance_of_an_encounter_15_0.png" />
</div>
</div>
<div class="section" id="selecting-a-survey-strategy-for-end-period-plastics">
<h3>Selecting a survey strategy for End Period Plastics<a class="headerlink" href="#selecting-a-survey-strategy-for-end-period-plastics" title="Permalink to this headline">¶</a></h3>
<p>The succesfull strategy attempts to maximize the time on locations with a higher probability of finding an FHP. Depsite the differences between the priors the posterior distributions are all simmilar. Tables 2 and 5 reaffirm the effects of the lake but at the cost of minimizing the effects  local results. Without the information from the lake uncertainty is maximized, complicating the decision making process. The model that appears to have the best compromise between the lake values and the local values is the scaled model, Table 3 and Figure 2. The range of the 90% HDI is half of the uninformed model and the variance is reduced by an order of magnitude. The locations with fewest samples, (rocky-plage, baby-plage-ii-geneve, jardin-botanique) are the most effected by the prior, with the highest variance, expected value and 90% HDI. However, the repeated sampling at villa-barton and baby-plage suggest that the probability of finding an FHP at Geneva is less than <span class="math notranslate nohighlight">\(\theta_{lake}\)</span> and Port Saint Louis, Figure 5.</p>
<p>The Bayes factor, a ratio of two integrals, was calculated using <span class="math notranslate nohighlight">\(\theta_{scaled}\)</span> in the numerator, this ratio compares the marginal probability of the observed results from one model to another,  <em>Eq.(20)</em>. The Bayes factor,  is sensitive to changes in the prior distribution, which is what we are testing for, <a class="reference internal" href="#s4"><span class="std std-ref">S4 Computing the integrals</span></a>. As there was no real predicted difference in accuracy from one model to the other, <a class="reference internal" href="#s4"><span class="std std-ref">S4 Table 6</span></a>, 1000 simulations of the 250 samples were performed by sampling the posterior distribution of <span class="math notranslate nohighlight">\(\theta_{location}\)</span> for each location under case 2. The sample of <span class="math notranslate nohighlight">\(\theta_{location}\)</span> is then used to make one draw from the Binomial distribution. Each location was sampled the same number of times as the original data set. The results are within the values predicted by the observed data <a class="reference internal" href="#s5"><span class="std std-ref">S5 Sampling the posterior distribution</span></a>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\frac{P(\theta_{priorone} | Data)}{P(\theta_{priortwo} | Data)} &amp;= 
\frac{P(Data | \theta_{priorone})P(\theta_{priorone})}{P(Data | \theta_{priortwo})P(\theta_{priortwo})} \tag{20} \\
\end{align}
\end{split}\]</div>
<p>The sampling strategy was devised using the restults from Table 3 and recognizing that the expected values in Geneva are reasonable given the data from the lake and Port Saint Louis, Figure 5. It was concluded that the probability was greatest on the right bank. Therefore the first survey site was villa-barton, the closest to the train station, and if none were found the search would continue at jardin-botanique. There is a substantial gain in travel time on the right bank with some loss in <span class="math notranslate nohighlight">\(E[\theta]\)</span> at villa-barton and an accompanying increase <span class="math notranslate nohighlight">\(E[\theta]\)</span> at jardin-botanique compared to the left bank.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># results by region</span>

<span class="n">r_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;haut_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;petite_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;grand_lac&quot;</span><span class="p">]</span>
<span class="n">labels</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">T_saint</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>

<span class="c1"># collect all the distributions</span>
<span class="n">regions</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># the results by region:</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">hlac</span><span class="p">,</span> <span class="n">plac</span><span class="p">,</span> <span class="n">glac</span><span class="p">]):</span>
    
    <span class="c1"># for FHP &gt; 0</span>
    <span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;fail&quot;</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="n">dfBeaches</span><span class="p">[</span><span class="n">dfBeaches</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">region</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">T_locations</span><span class="p">[</span><span class="n">T_locations</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">locations</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>
    
    <span class="n">b_updated_one</span><span class="p">,</span> <span class="n">dists_one</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">data</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labels</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="n">prior_one</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    <span class="n">b_updated_two</span><span class="p">,</span> <span class="n">dists_two</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">data</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labels</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    <span class="n">b_updated_three</span><span class="p">,</span> <span class="n">dists_three</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">data</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labels</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="n">scaled_prior_one</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    
    
    <span class="n">regions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">r_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:{</span><span class="s2">&quot;locations&quot;</span><span class="p">:</span><span class="n">locations</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;lake&quot;</span><span class="p">:</span><span class="n">dists_one</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">:</span><span class="n">dists_two</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">:</span><span class="n">dists_three</span><span class="p">}})</span>
    
    <span class="c1"># for FHP &gt; 1</span>
    <span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;plus_two&quot;</span>
        
    <span class="n">b_updated_four</span><span class="p">,</span> <span class="n">dists_four</span> <span class="o">=</span> <span class="n">make_posterior_and_array_of_results</span><span class="p">([</span><span class="n">data</span><span class="p">],</span> <span class="n">beta</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">labels</span><span class="p">],</span> <span class="n">prior</span><span class="o">=</span><span class="n">scaled_prior_one</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    <span class="n">regions</span><span class="p">[</span><span class="n">r_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;tuples_2&quot;</span><span class="p">:</span><span class="n">b_updated_four</span><span class="p">,</span> <span class="s2">&quot;plus_two&quot;</span><span class="p">:</span> <span class="n">dists_four</span><span class="p">})</span>

<span class="c1"># the aggregated regional results</span>
<span class="n">regions_agg</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">r_names</span><span class="p">:</span>
    <span class="n">a_sum</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;loc_date&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">a_sum</span><span class="o">.</span><span class="n">fail</span><span class="p">,</span> <span class="n">a_sum</span><span class="o">.</span><span class="n">loc_date</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="n">t</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">scaled_prior_one</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="o">+</span><span class="n">scaled_prior_one</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">av</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">stats</span><span class="p">()</span>
    <span class="n">five</span><span class="p">,</span> <span class="n">ninefive</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.05</span><span class="p">),</span> <span class="n">dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.95</span><span class="p">)</span>
    <span class="n">update</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">av</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">var</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">interval</span><span class="o">=</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">five</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="n">ninefive</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">regions_agg</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">name</span><span class="p">:</span><span class="n">update</span><span class="p">})</span>
    
<span class="c1"># the distribution for the lake    </span>
<span class="n">t_and_n</span> <span class="o">=</span> <span class="n">T_lake</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;loc_date&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>
<span class="n">t</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">t_and_n</span><span class="o">.</span><span class="n">fail</span><span class="p">,</span> <span class="n">t_and_n</span><span class="o">.</span><span class="n">loc_date</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="n">t</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">k</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">stats</span><span class="p">()</span>
<span class="n">five</span><span class="p">,</span> <span class="n">ninefive</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.05</span><span class="p">),</span> <span class="n">dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.95</span><span class="p">)</span>
<span class="n">update</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">five</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="n">ninefive</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">regions_agg</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;lake&quot;</span><span class="p">:</span><span class="n">update</span><span class="p">})</span>

<span class="c1"># the reference value</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/plage_napoleon.csv&quot;</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">trouver</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">k</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="n">t</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="mf">9.59</span><span class="o">+</span><span class="n">t</span><span class="p">,</span> <span class="mf">13.64</span><span class="o">+</span><span class="n">k</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">stats</span><span class="p">()</span>
<span class="n">five</span><span class="p">,</span> <span class="n">ninefive</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.05</span><span class="p">),</span> <span class="n">dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.95</span><span class="p">)</span>
<span class="n">update</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">five</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="n">ninefive</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">regions_agg</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;port-saint-louis&quot;</span><span class="p">:</span><span class="n">update</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
<span class="n">columnone</span><span class="o">=</span><span class="s2">&quot;scaled&quot;</span>
<span class="n">columntwo</span><span class="o">=</span><span class="s2">&quot;plus_two&quot;</span>

<span class="n">geneve</span><span class="o">=</span> <span class="n">T_geneva</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>


<span class="n">d_o</span> <span class="o">=</span><span class="p">[</span><span class="n">mapper</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Figure 6: Haut lac&quot;</span><span class="p">,</span> <span class="s2">&quot;Figure 7: Grand lac&quot;</span><span class="p">,</span> <span class="s2">&quot;Figure 8: Petit lac&quot;</span><span class="p">,</span> <span class="s2">&quot;Lake&quot;</span><span class="p">,</span> <span class="s2">&quot;Port Saint Louis&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">make_bounds_from_mean</span><span class="p">(</span><span class="n">a_mean</span><span class="p">,</span> <span class="n">a_range</span><span class="p">,</span> <span class="n">d_o</span><span class="p">):</span>
    <span class="n">l_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a_mean</span> <span class="o">-</span> <span class="p">(</span><span class="n">a_range</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">d_o</span><span class="p">[</span><span class="n">l_bound</span><span class="p">:</span><span class="n">a_mean</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="o">*</span><span class="n">lower</span><span class="p">,</span> <span class="o">*</span><span class="n">lower</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

<span class="k">def</span> <span class="nf">make_row_index</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">unique</span><span class="p">):</span>
    <span class="n">a_row_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">unique</span><span class="p">])</span><span class="o">/</span><span class="n">r</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a_row_index</span>

<span class="k">def</span> <span class="nf">make_an_interval_and_range</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">place</span><span class="p">):</span>
    <span class="n">interval</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">place</span><span class="p">][</span><span class="s2">&quot;interval&quot;</span><span class="p">]</span>
    <span class="n">a_mean</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">place</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">int_ints</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
    <span class="n">a_range</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">int_ints</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">int_ints</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">a_mean</span><span class="p">,</span> <span class="n">int_ints</span><span class="p">,</span> <span class="n">a_range</span>

<span class="k">def</span> <span class="nf">summarize_for_one_code</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">subplot_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;haut_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;grand_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;petite_lac&quot;</span><span class="p">],</span> 
                           <span class="n">unique</span><span class="o">=</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="n">r_c</span> <span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span> <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span> <span class="n">d_o</span><span class="o">=</span><span class="n">d_o</span><span class="p">,</span> <span class="n">columnone</span><span class="o">=</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span>
                          <span class="n">regional_data</span><span class="o">=</span><span class="p">{}):</span>
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">r_c</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
        
    <span class="n">rowone</span> <span class="o">=</span> <span class="n">make_row_index</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">subplot_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">r</span><span class="p">,</span><span class="n">unique</span><span class="p">)</span>
    <span class="n">rowtwo</span> <span class="o">=</span> <span class="n">make_row_index</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">subplot_names</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">r</span><span class="p">,</span><span class="n">unique</span><span class="p">)</span>
    <span class="n">rowthree</span><span class="o">=</span><span class="n">make_row_index</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">subplot_names</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">r</span><span class="p">,</span><span class="n">unique</span><span class="p">)</span>
    
    <span class="n">gs0</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">subplot_spec</span><span class="o">=</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">gs01</span><span class="o">=</span> <span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">subgridspec</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
     
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs0</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">rowone</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">axtwo</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs01</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">rowthree</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">axthree</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs0</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">rowone</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">20</span><span class="p">,:])</span>
    <span class="n">axfour</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs01</span><span class="p">[</span><span class="n">rowthree</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">axfive</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs01</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="p">:])</span>
    <span class="c1"># rowsix = fig.add_subplot(gs01[rowthree+1: 2+(rowthree+1), :])</span>
    
    
    <span class="n">figtitle</span> <span class="o">=</span> <span class="sa">F</span><span class="s2">&quot;Figure 5</span><span class="se">\n</span><span class="s2">Probability of finding an FHP </span><span class="se">\n</span><span class="s2">Lake Geneva and regions</span><span class="se">\n</span><span class="s2"> prior = Beta(9.59, 13.64)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">figtitle</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">,</span>  <span class="n">axthree</span><span class="p">,</span> <span class="n">axtwo</span><span class="p">]</span>
 
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subplot_names</span><span class="p">):</span>

        <span class="c1"># this is the data</span>
        <span class="n">region_data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">region</span><span class="p">][</span><span class="n">columnone</span><span class="p">]</span>
                
        <span class="c1"># hold tick labels</span>
        <span class="n">place_labels</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># the datakeys are the identifier</span>
        <span class="n">places</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">region_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="c1"># group locations in the same city</span>
        <span class="n">cities</span> <span class="o">=</span> <span class="n">dfBeaches</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">places</span><span class="p">]</span><span class="o">.</span><span class="n">city</span>
        <span class="n">cit</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
        
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">place</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cit</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
            
            <span class="n">a_mean</span><span class="p">,</span> <span class="n">int_ints</span><span class="p">,</span> <span class="n">a_range</span> <span class="o">=</span> <span class="n">make_an_interval_and_range</span><span class="p">(</span><span class="n">region_data</span><span class="p">,</span> <span class="n">place</span><span class="p">)</span>
            
            <span class="n">intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">int_ints</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">int_ints</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">gridc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">int_ints</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">int_ints</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            
            <span class="n">c_norm</span> <span class="o">=</span> <span class="n">make_bounds_from_mean</span><span class="p">(</span><span class="n">a_mean</span><span class="p">,</span> <span class="n">a_range</span><span class="p">,</span> <span class="n">d_o</span><span class="p">)</span>           
            
            <span class="n">place_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">place</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">intervals</span><span class="p">:</span>
                
                <span class="n">block</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">gridc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">.9</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">c_norm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">place</span> <span class="ow">in</span> <span class="n">saint_sulpice</span><span class="p">:</span>
                <span class="n">edge_color</span> <span class="o">=</span> <span class="s2">&quot;dodgerblue&quot;</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.8</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">gridc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">j</span><span class="p">),</span> <span class="n">a_range</span><span class="p">,</span> <span class="mf">.9</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edge_color</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">place</span> <span class="ow">in</span> <span class="n">geneve</span><span class="p">:</span>
                <span class="n">edge_color</span> <span class="o">=</span> <span class="s2">&quot;magenta&quot;</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.8</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">gridc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">j</span><span class="p">),</span> <span class="n">a_range</span><span class="p">,</span> <span class="mf">.9</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edge_color</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>          
                   
            <span class="c1"># axs[k].scatter([a_mean], [j+.5], marker=&quot;|&quot;, s=200, c=&quot;red&quot;)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">a_mean</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mf">.05</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mf">.95</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Expected value&quot;</span><span class="p">)</span>
        <span class="n">b</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
        <span class="n">c</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>

        <span class="n">y_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mf">.5</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">place_labels</span><span class="p">))]</span>
        <span class="n">x_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">x_ticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">%&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_ticks</span><span class="p">]</span>

        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">x_ticklabels</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">place_labels</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">.1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cit</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelrotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
    <span class="n">axfourlabels</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">sname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;port-saint-louis&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">subplot_names</span><span class="p">,</span> <span class="s2">&quot;lake&quot;</span><span class="p">]):</span>        

        <span class="n">a_mean</span><span class="p">,</span> <span class="n">int_ints</span><span class="p">,</span> <span class="n">a_range</span> <span class="o">=</span> <span class="n">make_an_interval_and_range</span><span class="p">(</span><span class="n">regional_data</span><span class="p">,</span> <span class="n">sname</span><span class="p">)</span>

        <span class="n">intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">int_ints</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">int_ints</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">gridc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">int_ints</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">int_ints</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">c_norm</span> <span class="o">=</span> <span class="n">make_bounds_from_mean</span><span class="p">(</span><span class="n">a_mean</span><span class="p">,</span> <span class="n">a_range</span><span class="p">,</span> <span class="n">d_o</span><span class="p">)</span>

        

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">intervals</span><span class="p">:</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">gridc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">num</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">c_norm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">axfour</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
        <span class="n">axfour</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">a_mean</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">num</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">num</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Expected value&quot;</span><span class="p">)</span>
    
    
    <span class="n">axfour</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Reference value: Port Saint Louis, Marseille, France&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="c1"># block for legend    </span>
    <span class="n">legend_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">gridc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">c_norm</span> <span class="o">=</span> <span class="n">make_bounds_from_mean</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="n">d_o</span><span class="p">)</span>    

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">legend_int</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">gridc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">.52</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">c_norm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">axfive</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    
    <span class="n">axfive</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mf">.28</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mf">0.48</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Expected value&quot;</span><span class="p">)</span>
    <span class="n">axfive</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">.38</span><span class="p">,</span> <span class="mf">.62</span><span class="p">])</span>
    <span class="n">axfive</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;Expected value&quot;</span><span class="p">,</span> <span class="s2">&quot;90% probabitlity interval&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
         
    <span class="n">axfive</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">axfive</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">axfive</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axfive</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axfive</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axfive</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axfive</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
   
    
    <span class="n">a</span><span class="o">=</span><span class="n">axfour</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mf">.5</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="o">*</span><span class="n">subplot_names</span><span class="p">,</span> <span class="s2">&quot;lake&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">]))])</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;Port Saint Louis&quot;</span><span class="p">,</span><span class="s2">&quot;Haut lac&quot;</span><span class="p">,</span> <span class="s2">&quot;Grand lac&quot;</span><span class="p">,</span> <span class="s2">&quot;Petit lac&quot;</span><span class="p">,</span> <span class="s2">&quot;Lake&quot;</span> <span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">)</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">x_ticklabels</span><span class="p">)</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelrotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>    
    
    <span class="n">axfour</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axfour</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>   
  
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="n">summarize_for_one_code</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">regional_data</span><span class="o">=</span><span class="n">regions_agg</span><span class="p">,</span> <span class="n">subplot_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;haut_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;grand_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;petite_lac&quot;</span><span class="p">],</span> <span class="n">unique</span><span class="o">=</span><span class="s2">&quot;locations&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">r_c</span> <span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span> <span class="n">d_o</span><span class="o">=</span><span class="n">d_o</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chance_of_an_encounter_18_0.png" src="_images/chance_of_an_encounter_18_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="environmental-policy-implications">
<h2>ENVIRONMENTAL POLICY IMPLICATIONS<a class="headerlink" href="#environmental-policy-implications" title="Permalink to this headline">¶</a></h2>
<p>The introduction of a litter threshold and the incorporation of the risk of marine-litter in LCA are important developments in the domain of marine-litter reduction and should have far reaching consequences in manufacturing and product development. However, measuring effectivenss by quantity may not be adequate for all objects. FHP are a very small portion of the total objects found yet the probability of finding one at a survey ranges from .35 -.45 for the lake and in some locations ranges from .40 - .60. Having found an FHP on the survey with End Period Plasitcs gives cause both to the method of assessment and the accuracy. These values are within the expected range of Port Saint Louis, the next location in the river basin which discharges into the Ocean. Consequently we assume that the odds of finding an FHP at a litter-survey in the Rhône basin are between 3/10 and 6/10 with the odds increasing in areas of low water velocity and immediately downstream of urban centers or dischage points.</p>
<p>Monitoring schedules or cadence should be characterized by the scale of the intended use of the data. For example the density of points used to describe <span class="math notranslate nohighlight">\(\theta_{lake}\)</span> is much greater than rocky-plage as a result we are confident about <span class="math notranslate nohighlight">\(\theta_{lake}\)</span> given the data however if we consider rocky-plage only on the results from rocky-plage then we are much less confident, Figure 3. The best inferences that can be made about any location include the results of other locations in proximity. In the case of Geneva there were two sets of data (baby-plage-geneva, villa-barton) of <span class="math notranslate nohighlight">\(\approxeq\)</span> length that described two logical divisions of the area under study. Putting the results from neighboring locations with fewer surveys in to a broader context immediately. This allows for a better understanding of whats happening at a local level in relation to regional or national trends. The advantage of sampling one location multiple times needs to be weighed against having many different sources of information from a defined geographic area.</p>
<p>The chance of an encounter is in the spirit of the data generating process that is called a <em>beach litter survey</em>. At its best implementation a beach-litter-survey is the definition of the minimum number of objects encountered, it should never be confused with the <em>actual</em> number that was present. The magnitude of the encounter can be measured in p/100m, the progression from the Binomial distribution to the Negative Binomial (NB) distribution is automatic. For example in this analysis the only probability that was considered was FHP = 0 or FHP &gt; 0, this operation can be repeated for all integer values. Given that the Beta distribtuion is also the conjugate prior to the NB and that it is already a recommended method for determining extreme values from a set of beach-litter data <span id="id57">[<a class="reference internal" href="references.html#id3" title="van Loon W. Hanke G., Walvoort D. Eu marine beach litter baselines. Publications Office of the European Union, 2019. doi:10.2760/16903.">HG19</a>]</span> there is ample reason to measure encounters and magnitude with the same method if possible.</p>
<p>In the simple model presented here the prior was scaled based on minimizing the paramaters of the Beta distribution of the prior. This may not always be appropriate or adviseable, a weighted average of both models may be a better indicator. Using the Bayes factor to evaluate model performance is appropriate in this case because the changes that are being evaluated are the changes in the prior. Developing more sophisticated models will mean changing the method of testing. Ulitmately the best way to simplify the model is to sample in such away that the number of samples is considered from the standpoint of the lowest administrative level that will use the data. For example a unified monitoring scheme for Lake Geneva would include a strategy that ensures the data is appropriate for use at the municipal level.</p>
<p>Application to the LCA is obvious in the context of risk. Determining the number consumed v/s the number found for any particular location or object would be problematic and relying on aggregate values that can not readily be verified or updated introduces ambiguity into the model that is best avoided. Land use statistics can be proxies for other independent variables that are difficult to measure and maybe a good indicator.  Spearmans <span class="math notranslate nohighlight">\(\rho\)</span> has been used to estimate the effects of different levels of land use on the survey results for the most common litter items <span id="id58">[<a class="reference internal" href="references.html#id21" title="Shannon et all Erismann. Identification, quantification and analysis of observable anthropogenic litter along swiss freshwater systems¶. Technical Report, hammerdirt, 2021. URL: https://hammerdirt-analyst.github.io/IQAASL-End-0f-Sampling-2021/titlepage.html, doi:10.5281/zenodo.6053926.">Eri21</a>]</span>. Rank based hypothesis testing can be implemented for probabilistic models <span id="id59">[<a class="reference internal" href="references.html#id42" title="van Doorn J.; Ly A.; Marsman M.; Wagenmakers E.-J. Bayesian rank-based hypothesis testing for the rank sum test, the signed rank test, and spearman’s ρ. Journal of Applied Sciences, 2020. doi:10.1080/02664763.2019.1709053.">vDJLAMMWEJ20</a>]</span>, this could lead to easier implementation within the context of existing processes such as LCA.</p>
<p>Finally, if the source of the data (citizen-science and activism) is considered and its traditional use as an early warning system for researchers and regional authorities then unilikely encounters should have a particular significance. Incorporating the probability of a result as a matter of practice is the realization of the relationship between activism citizen-science and environmental stewardship.  Building consensus based on the significance of survey results that were collected according to a protocol by concerned members of the community and analyzed in a transparent manner is a logical extension of the data collection process.</p>
</div>
<div class="section" id="supporting-figures-and-calculations">
<h2>Supporting figures and calculations<a class="headerlink" href="#supporting-figures-and-calculations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="s1-survey-locations-number-of-samples-and-the-number-of-times-an-fhp-was-identified">
<span id="s1"></span><h3>S1: Survey locations, number of samples and the number of times an FHP was identified<a class="headerlink" href="#s1-survey-locations-number-of-samples-and-the-number-of-times-an-fhp-was-identified" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>samples</th>
      <th>FHP</th>
    </tr>
    <tr>
      <th>city</th>
      <th>location</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Allaman</th>
      <th>la-pecherie</th>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Bourg-en-Lavaux</th>
      <th>cully-plage</th>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">Genève</th>
      <th>baby-plage-geneva</th>
      <td>11</td>
      <td>3</td>
    </tr>
    <tr>
      <th>baby-plage-ii-geneve</th>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>jardin-botanique</th>
      <td>3</td>
      <td>2</td>
    </tr>
    <tr>
      <th>rocky-plage</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>villa-barton</th>
      <td>12</td>
      <td>2</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Gland</th>
      <th>lacleman_gland_kubela</th>
      <td>11</td>
      <td>3</td>
    </tr>
    <tr>
      <th>lacleman_gland_lecoanets</th>
      <td>11</td>
      <td>4</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">La Tour-de-Peilz</th>
      <th>anarchy-beach</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>bain-des-dames</th>
      <td>4</td>
      <td>3</td>
    </tr>
    <tr>
      <th>le-port</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>maladaire</th>
      <td>15</td>
      <td>3</td>
    </tr>
    <tr>
      <th>oyonne</th>
      <td>3</td>
      <td>2</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">Lausanne</th>
      <th>lacleman_vidy_santie</th>
      <td>12</td>
      <td>10</td>
    </tr>
    <tr>
      <th>vidy</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>vidy-ruines</th>
      <td>7</td>
      <td>2</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">Montreux</th>
      <th>baye-de-clarens</th>
      <td>13</td>
      <td>1</td>
    </tr>
    <tr>
      <th>baye-de-montreux-d</th>
      <td>16</td>
      <td>5</td>
    </tr>
    <tr>
      <th>baye-de-montreux-g</th>
      <td>18</td>
      <td>2</td>
    </tr>
    <tr>
      <th>le-pierrier</th>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>pierrier-sud</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Morges</th>
      <th>la-morges</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Préverenges</th>
      <th>preverenges</th>
      <td>14</td>
      <td>9</td>
    </tr>
    <tr>
      <th>preverenges-le-sout</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Rolle</th>
      <th>rolle-plage</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Saint-Gingolph</th>
      <th>grand-clos</th>
      <td>13</td>
      <td>9</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">Saint-Sulpice (VD)</th>
      <th>parc-des-pierrettes</th>
      <td>4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>plage-de-dorigny</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>plage-de-st-sulpice</th>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>saint-sulpice</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>tiger-duck-beach</th>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Tolochenaz</th>
      <th>boiron</th>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>tolochenaz</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Versoix</th>
      <th>versoix</th>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">Vevey</th>
      <th>arabie</th>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>quai-maria-belgia</th>
      <td>22</td>
      <td>13</td>
    </tr>
    <tr>
      <th>veveyse</th>
      <td>17</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="s2-expected-values-holding-the-data-constant-and-changing-theta">
<span id="s2"></span><h3>S2: Expected values holding the data constant and changing <span class="math notranslate nohighlight">\(\theta\)</span><a class="headerlink" href="#s2-expected-values-holding-the-data-constant-and-changing-theta" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the different probabilities of having 103 successes given different values of theta</span>
<span class="n">theta_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span> <span class="mf">.3</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.7</span><span class="p">]</span>
<span class="n">surveys</span> <span class="o">=</span> <span class="mi">250</span>

<span class="c1"># loop through the different possible values of theta</span>
<span class="n">my_dists</span> <span class="o">=</span> <span class="p">[</span><span class="n">binom</span><span class="p">(</span><span class="n">surveys</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">theta_vals</span><span class="p">]</span>
<span class="n">my_stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">stats</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_dists</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">each_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">theta_vals</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Given theta=</span><span class="si">{</span><span class="n">each_val</span><span class="si">}</span><span class="s2">, and the number of surveys = </span><span class="si">{</span><span class="n">surveys</span><span class="si">}</span><span class="s2">, the expected number of positive surveys = </span><span class="si">{</span><span class="n">my_stats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Given theta=0.2, and the number of surveys = 250, the expected number of positive surveys = 50.0
Given theta=0.3, and the number of surveys = 250, the expected number of positive surveys = 75.0
Given theta=0.5, and the number of surveys = 250, the expected number of positive surveys = 125.0
Given theta=0.7, and the number of surveys = 250, the expected number of positive surveys = 175.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="s3-scaling-the-prior-minimizing-alpha-beta">
<span id="s3"></span><h3>S3: Scaling the prior, minimizing <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span><a class="headerlink" href="#s3-scaling-the-prior-minimizing-alpha-beta" title="Permalink to this headline">¶</a></h3>
<p>Suppose we weren’t given the the survey results, but we were given the the value of t/n for a given period. Consider the equality <em>500/1000 = 50/100 = 5/10 = 1/2 = .5</em> and now substitute t for the numerator and n for the denominator. Different parameters of the Beta distribution can produce similar results.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>

<span class="c1"># scaled prior</span>
<span class="k">def</span> <span class="nf">minimize_alpha_beta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    
    <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># define the mean and variance in terms of the parameters</span>
    <span class="c1"># mean or mu</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="p">)</span>
    
    <span class="c1"># standard deviation</span>
    <span class="n">v</span> <span class="o">=</span>  <span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="n">mu</span><span class="p">,</span> <span class="n">v</span> <span class="o">-</span> <span class="n">var</span><span class="p">]</span>


<span class="c1"># get the mean from the lake posterior and set variance to a limit</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">dists_lk</span><span class="p">[</span><span class="s2">&quot;lake&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
<span class="n">var</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># alpha beta minimized</span>
<span class="n">scaled</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">minimize_alpha_beta</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>

<span class="c1"># returns</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">9.5079</span><span class="p">,</span> <span class="mf">13.6821</span><span class="p">])</span>

</pre></div>
</div>
<p>The parameters of the Beta distribution can be described in terms of the mean and variance. The function <code class="docutils literal notranslate"><span class="pre">minimize_alpha_beta</span></code> starts from one and looks for the smallest values of <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span> that produce the same results as the proposed arguments, <code class="docutils literal notranslate"><span class="pre">args=(mu,</span> <span class="pre">var)</span></code> which are <span class="math notranslate nohighlight">\(E[\theta_{lake}]\)</span>, <span class="math notranslate nohighlight">\(E[Var(\theta)]\)</span>. The variance is increased by one order of magnitude which results in smaller values of <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span> but an increase in variance and the range of the 90% HDI, Figure S3.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">not_scaled</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="mi">103</span><span class="p">,</span> <span class="mi">147</span><span class="p">)</span>

<span class="n">scaled</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="mf">9.5079</span><span class="p">,</span> <span class="mf">13.6821</span><span class="p">)</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;not scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]</span>

<span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">the_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">not_scaled</span><span class="p">,</span> <span class="n">scaled</span><span class="p">]):</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">the_data</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.001</span><span class="p">),</span> <span class="n">the_data</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.999</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">the_data</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;S3: The difference between the scaled and the unscaled prior&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chance_of_an_encounter_26_0.png" src="_images/chance_of_an_encounter_26_0.png" />
</div>
</div>
</div>
<div class="section" id="s4-computing-the-integrals-for-marginal-probabiltity">
<span id="s4"></span><h3>S4: Computing the integrals for marginal probabiltity<a class="headerlink" href="#s4-computing-the-integrals-for-marginal-probabiltity" title="Permalink to this headline">¶</a></h3>
<p>The marginal probability is the integral of the <em>Likelihood * Prior</em>. Another good explanantion is <em>it is the probability of the data given <span class="math notranslate nohighlight">\(\theta\)</span> times the probablity of <span class="math notranslate nohighlight">\(\theta\)</span></em> for different values of <span class="math notranslate nohighlight">\(\theta\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>

<span class="k">def</span> <span class="nf">f_marginal_prob</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="n">pk</span><span class="p">,</span><span class="n">et</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The marginal probability is the Intgral of one function times another.  </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># the probability of theta under the prior</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>    
    <span class="c1"># the probability of t given n and theta</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">binom</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">et</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
   
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span>
</pre></div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># bayes factor to compare one to the other</span>
<span class="c1"># the marginal probability of the data under the different</span>
<span class="c1"># values of theta times the probability of theta under the conditions of the prior</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>

<span class="k">def</span> <span class="nf">f_marginal_prob</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="n">pk</span><span class="p">,</span><span class="n">et</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The marginal probability is the Intgral of one function times another.  </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># the probability of theta under the prior</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>    
    <span class="c1"># the probability of t given n and theta</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">binom</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">et</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
   
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span>

<span class="k">def</span> <span class="nf">variables_marginal_prob</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="n">pt</span><span class="o">=</span><span class="n">dt</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pk</span><span class="o">=</span><span class="n">dt</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">et</span><span class="o">=</span><span class="n">dt</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">pt</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">et</span><span class="p">,</span> <span class="n">n</span>


<span class="k">def</span> <span class="nf">collect_marginal_probabilities</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    
    <span class="n">marginals</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">anarray</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">this_marginal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">atuple</span> <span class="ow">in</span> <span class="n">anarray</span><span class="p">:</span>            
            <span class="n">these_vars</span> <span class="o">=</span> <span class="n">variables_marginal_prob</span><span class="p">(</span><span class="n">atuple</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">f_marginal_prob</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">these_vars</span><span class="p">)</span>
            <span class="n">this_marginal</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">these_vars</span><span class="p">])</span>
        <span class="n">marginals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_marginal</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">marginals</span>

<span class="k">def</span> <span class="nf">make_bfs</span><span class="p">(</span><span class="n">marginals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="n">m_one</span> <span class="o">=</span> <span class="n">marginals</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    
    <span class="n">bfs</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">marginal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">m_one</span><span class="p">):</span>
        
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">marginal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">didx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">marginal</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">index</span><span class="p">]</span>
        <span class="n">denominators</span> <span class="o">=</span> <span class="p">[</span><span class="n">marginals</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">didx</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">marginals</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">didx</span><span class="p">]</span>
                
        <span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span> <span class="k">for</span> <span class="n">denominator</span> <span class="ow">in</span> <span class="n">denominators</span><span class="p">]</span>
        <span class="n">bfs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">factors</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">bfs</span>
    
<span class="n">marginals</span> <span class="o">=</span> <span class="n">collect_marginal_probabilities</span><span class="p">(</span><span class="n">data_tuples</span><span class="p">)</span>
<span class="n">bfs</span> <span class="o">=</span> <span class="n">make_bfs</span><span class="p">(</span><span class="n">marginals</span><span class="p">)</span>

<span class="n">new_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bfs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span><span class="s2">&quot;lake&quot;</span><span class="p">,</span> <span class="s2">&quot;uninformed&quot;</span><span class="p">,</span> <span class="s2">&quot;period-3&quot;</span><span class="p">])</span>
<span class="n">new_data</span><span class="p">[[</span><span class="s2">&quot;lake&quot;</span><span class="p">,</span> <span class="s2">&quot;uninformed&quot;</span><span class="p">,</span> <span class="s2">&quot;period-3&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[[</span><span class="s2">&quot;lake&quot;</span><span class="p">,</span> <span class="s2">&quot;uninformed&quot;</span><span class="p">,</span> <span class="s2">&quot;period-3&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">chart_title</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Table 6: Bayes factor of $\theta_</span><span class="si">{scaled}</span><span class="s2">$ v/s all other priors&quot;</span>

<span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

<span class="n">a_simple_formatted_table</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">new_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">colLabels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">new_data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">a_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">.4</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="mf">.2</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">],</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">remove_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">remove_ticks</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">chart_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chance_of_an_encounter_28_0.png" src="_images/chance_of_an_encounter_28_0.png" />
</div>
</div>
</div>
<div class="section" id="s5-drawing-samples-from-the-posterior-distribution-of-each-location">
<span id="s5"></span><h3>S5: Drawing samples from the posterior distribution of each location<a class="headerlink" href="#s5-drawing-samples-from-the-posterior-distribution-of-each-location" title="Permalink to this headline">¶</a></h3>
<p>The method requires that <span class="math notranslate nohighlight">\(\theta\)</span> for each location is sampled and the result of that sample is applied to the Binomial distribution. In the example below, the locations are sampled by region, according to the order in Figures 5-8. A new value for <span class="math notranslate nohighlight">\(\theta\)</span> is drawn for each sample.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">draw_samples_from_each_location</span><span class="p">(</span><span class="n">nsamps</span><span class="p">,</span> <span class="n">r_names</span><span class="p">,</span> <span class="n">a_prior</span><span class="o">=</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="n">prior_args</span><span class="o">=</span><span class="p">(</span><span class="mf">9.59</span><span class="p">,</span> <span class="mf">13.64</span><span class="p">)):</span>
    <span class="n">sim_results</span> <span class="o">=</span> <span class="p">[]</span>    
    <span class="c1"># repeat all the samples n times</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nsamps</span><span class="p">):</span>        
        <span class="c1"># the results of one cycle get stored here</span>
        <span class="n">mcmc_samples</span> <span class="o">=</span> <span class="p">[]</span>        
        <span class="c1"># for each region</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">r_names</span><span class="p">:</span>
            <span class="c1"># collect the data for the region</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># for each prior</span>
            <span class="k">for</span> <span class="n">prior</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a_prior</span><span class="p">]:</span>
                <span class="n">these_results</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prior</span><span class="p">]</span>
                <span class="c1"># for each location</span>
                <span class="k">for</span> <span class="n">a_beach</span> <span class="ow">in</span> <span class="n">these_results</span><span class="p">:</span>
                    <span class="c1"># collect the args that were used to calculate the posterior</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prior</span><span class="p">][</span><span class="n">a_beach</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>
                    <span class="c1"># get the t,n for that location</span>
                    <span class="n">t</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">prior_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">prior_args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">a</span><span class="o">-</span><span class="n">prior_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># sample each location n times</span>
                    <span class="c1"># draw a sample for theta</span>
                    <span class="c1"># use the sample theta to look for FHP</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>                        
                        <span class="c1"># get the dist for that location and draw a sample for theta</span>
                        <span class="n">theta</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prior</span><span class="p">][</span><span class="n">a_beach</span><span class="p">][</span><span class="s2">&quot;this_dist&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
                        <span class="c1"># use that theta for one sample</span>
                        <span class="n">draw</span> <span class="o">=</span> <span class="n">binom</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                        <span class="c1"># store the result</span>
                        <span class="n">mcmc_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">draw</span><span class="p">)</span>
        
        <span class="n">sim_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mcmc_samples</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">sim_results</span>

</pre></div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">draw_samples_from_each_location</span><span class="p">(</span><span class="n">nsamps</span><span class="p">,</span> <span class="n">r_names</span><span class="p">,</span> <span class="n">a_prior</span><span class="o">=</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="n">prior_args</span><span class="o">=</span><span class="p">(</span><span class="mf">9.59</span><span class="p">,</span> <span class="mf">13.64</span><span class="p">)):</span>
    <span class="n">sim_results</span> <span class="o">=</span> <span class="p">[]</span>    
    <span class="c1"># repeat all the samples n times</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nsamps</span><span class="p">):</span>        
        <span class="c1"># the results of one cycle get stored here</span>
        <span class="n">mcmc_samples</span> <span class="o">=</span> <span class="p">[]</span>        
        <span class="c1"># for each region</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">r_names</span><span class="p">:</span>
            <span class="c1"># collect the data for the region</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># for each prior</span>
            <span class="k">for</span> <span class="n">prior</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a_prior</span><span class="p">]:</span>
                <span class="n">these_results</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prior</span><span class="p">]</span>
                <span class="c1"># for each location</span>
                <span class="k">for</span> <span class="n">a_beach</span> <span class="ow">in</span> <span class="n">these_results</span><span class="p">:</span>
                    <span class="c1"># collect the args that were used to calculate the posterior</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prior</span><span class="p">][</span><span class="n">a_beach</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>
                    <span class="c1"># get the t,n for that location</span>
                    <span class="n">t</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">prior_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">prior_args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">a</span><span class="o">-</span><span class="n">prior_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># sample each location n times</span>
                    <span class="c1"># draw a sample for theta</span>
                    <span class="c1"># use the sample theta to look for FHP</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>                        
                        <span class="c1"># get the dist for that location and draw a sample for theta</span>
                        <span class="n">theta</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prior</span><span class="p">][</span><span class="n">a_beach</span><span class="p">][</span><span class="s2">&quot;this_dist&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
                        <span class="c1"># use that theta for one sample</span>
                        <span class="n">draw</span> <span class="o">=</span> <span class="n">binom</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                        <span class="c1"># store the result</span>
                        <span class="n">mcmc_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">draw</span><span class="p">)</span>
        
        <span class="n">sim_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mcmc_samples</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">sim_results</span>

<span class="n">nsamps</span> <span class="o">=</span> <span class="mi">1000</span>
        
<span class="n">sim_scaled</span> <span class="o">=</span>   <span class="n">draw_samples_from_each_location</span><span class="p">(</span><span class="n">nsamps</span><span class="p">,</span> <span class="n">r_names</span><span class="p">)</span>

<span class="n">sim_t</span><span class="p">,</span> <span class="n">sim_k</span><span class="p">,</span> <span class="n">sim_tn</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sim_scaled</span><span class="p">],</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sim_scaled</span><span class="p">],</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">250</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sim_scaled</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicted number of samples with FHP = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sim_t</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicted number of samples without FHP = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sim_k</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average value of t/n over </span><span class="si">{</span><span class="n">nsamps</span><span class="si">}</span><span class="s2"> samples = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sim_tn</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variance of t/n over </span><span class="si">{</span><span class="n">nsamps</span><span class="si">}</span><span class="s2"> samples = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">sim_tn</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variance of sim_t over </span><span class="si">{</span><span class="n">nsamps</span><span class="si">}</span><span class="s2"> samples = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">sim_t</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Predicted number of samples with FHP = 101
Predicted number of samples without FHP = 148
Average value of t/n over 1000 samples = 0.41
Variance of t/n over 1000 samples = 0.0009
Variance of sim_t over 1000 samples = 54
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g_lac</span> <span class="o">=</span> <span class="n">dfBeaches</span><span class="p">[</span><span class="n">dfBeaches</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">glac</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">g_lac</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;grand-lac&quot;</span>
<span class="n">p_lac</span> <span class="o">=</span> <span class="n">dfBeaches</span><span class="p">[</span><span class="n">dfBeaches</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">plac</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">p_lac</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;petit-lac&quot;</span>

<span class="n">mapvals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">g_lac</span><span class="p">,</span> <span class="n">p_lac</span><span class="p">])</span>
<span class="n">mapvals</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;resources/mapvals.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">author</span> <span class="o">=</span> <span class="s2">&quot;roger@hammerdirt.ch&quot;</span>
<span class="n">my_message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\u2764\ufe0f</span><span class="s2"> what you do.&quot;</span>
<span class="n">md</span><span class="p">(</span><span class="sa">F</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;br&gt;&lt;/br&gt;</span>
<span class="s2">**Hammerdirt everyday.**&lt;br&gt;</span>

<span class="s2">&gt;</span><span class="si">{</span><span class="n">my_message</span><span class="si">}</span><span class="s2">&lt;br&gt;</span>

<span class="s2">*</span><span class="si">{</span><span class="n">author</span><span class="si">}</span><span class="s2">* pushed the run button.&lt;br&gt;</span>
<span class="s2">This document originates from https://github.com/hammerdirt-analyst/ all copyrights apply.&lt;br&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p><br></br>
<strong>Hammerdirt everyday.</strong><br></p>
<blockquote>
<div><p>❤️ what you do.<br></p>
</div></blockquote>
<p><em>roger&#64;hammerdirt.ch</em> pushed the run button.<br>
This document originates from https://github.com/hammerdirt-analyst/ all copyrights apply.<br></p>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="titlepage.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">The probability of trash</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="references.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">References</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Hammerdirt collaboration<br/>
    
      <div class="extra_footer">
        <p>
   \u2764\ufe0f what you do.
</p>

      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>